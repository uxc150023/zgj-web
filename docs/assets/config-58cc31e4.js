import{r as e,a1 as a,F as l,G as n,H as s,J as t,P as i,U as c,O as o,R as d,I as r,B as u,N as v,V as h,W as m,C as g,K as p,S as y,T as f,u as b,Q as k}from"./chunk-element-plus-a77de3d2.js";import{_ as C}from"./back-bdc75944.js";import{c as _}from"./Layout-e90710df.js";import{g as w,u as I,$ as x,E as S,G as j,n as P,a0 as O,a4 as q,a5 as A,a3 as E,j as L,o as U,P as $}from"./chunk-vform-d740b35c.js";import{a as B}from"./authorityManagement-64dea20a.js";const F=e=>(h("data-v-ce06d115"),e=e(),m(),e),N={class:"permission-selected"},R={key:0,class:"label"},V=[F((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#bumen"})],-1))),d(" 选中部门 ")],D={key:1,class:"permission-selected-role-list"},z={key:0},G={key:1},M=["onClick"],H={key:0,class:"child-organ"},J=["onClick"],K={key:2,class:"label"},Q=[F((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),d(" 选中员工")],T={key:3,class:"permission-selected-role-list"},W={class:"organ"},X={class:"role-container-a"},Y=F((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),Z=["onClick"],ee=F((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#role-active"})],-1))),ae={key:4,class:"empty"},le=[F((()=>s("div",{class:"box"},[s("div",null,[s("img",{src:O})])],-1)))],ne={class:"permission-selected-role-list"},se={class:"role-container",ref:"roleRef"},te=F((()=>s("svg",{class:"iconpark-icon"},[s("use",{href:"#yuangong"})],-1))),ie={name:"Selected"},ce=w(Object.assign(ie,{setup(h){const m=I(),g=e({organs:[],users:[]}),p=e(!1),y=e([]),f=e=>e.map((e=>e.name)).join(" > "),b=async e=>{try{p.value=!0;const a=await j.userListByOrgan(e);y.value=a.data}catch(a){S(a)}};return(async()=>{try{const e=await x.systemOrganOrPerson.getRoleDataScopeEcho(m.query.roleId);g.value=e.data}catch(e){S(e)}})(),a((()=>{})),(e,a)=>{const h=P;return l(),n(i,null,[s("div",N,[g.value.organs.length?(l(),n("p",R,V)):t("",!0),g.value.organs.length?(l(),n("div",D,[(l(!0),n(i,null,c(g.value.organs,((e,a)=>(l(),n("div",{key:a},[s("div",{class:"organ",style:o(["0"===e.includeChild?"margin-bottom: 24px":"",{display:"flex","justify-content":"space-between"}])},[s("p",null,[d(r(f(e.organInfo))+" ",1),"0"===e.includeChild?(l(),n("span",z,"（不包含下级）")):(l(),n("span",G,"（包含下级）"))]),"0"===e.includeChild?(l(),n("a",{key:0,onClick:a=>b(e.organInfo[0].id)},"查看员工 》",8,M)):t("",!0)],4),"0"!==e.includeChild?(l(),n("div",H,[(l(!0),n(i,null,c(e.subOrganInfoList,((e,a)=>(l(),n("div",{class:"organ",style:{"margin-bottom":"24px",display:"flex","justify-content":"space-between"},key:a},[s("p",null,r(f(e)),1),s("a",{onClick:a=>b(e[e.length-1].id)},"查看员工 》",8,J)])))),128))])):t("",!0)])))),128))])):t("",!0),g.value.users.length?(l(),n("p",K,Q)):t("",!0),g.value.users.length?(l(),n("div",T,[(l(!0),n(i,null,c(g.value.users,((e,a)=>(l(),n("div",{key:a},[s("div",W,r(f(e.organInfo)),1),s("div",{class:"role-container",ref_for:!0,ref:"roleRef"},[s("div",X,[(l(!0),n(i,null,c(e.userInfo.slice(0,9),((e,a)=>(l(),n("div",{key:a,class:"role"},[Y,d(" "+r(e.name),1)])))),128))]),e.userInfo.length>3?(l(),n("div",{key:0,class:"role sum",onClick:a=>{return l=e.userInfo,p.value=!0,void(y.value=l);var l}},[ee,d(" +"+r(e.userInfo.length),1)],8,Z)):t("",!0)],512)])))),128))])):t("",!0),g.value.users.length||g.value.organs.length?t("",!0):(l(),n("div",ae,le))]),u(h,{"onUpdate:show":a[0]||(a[0]=e=>p.value=e),show:p.value,"destroy-on-close":"",title:"成员信息",width:900,footer:!1},{default:v((()=>[s("div",ne,[s("div",se,[(l(!0),n(i,null,c(y.value,((e,a)=>(l(),n("div",{key:a,class:"role"},[te,d(" "+r(e.name),1)])))),128))],512)])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-ce06d115"]]),oe=e=>(h("data-v-0a5af12b"),e=e(),m(),e),de={class:"Functions-container"},re={class:"container1 container"},ue={key:0,class:"container2 container"},ve={class:"left"},he=["onClick"],me=[oe((()=>s("use",{href:"#down"},null,-1)))],ge={class:"right"},pe={key:0},ye=oe((()=>s("template",null,null,-1))),fe=d("   "),be={key:0,class:"container3 container"},ke={class:"left"},Ce=["onClick"],_e=[oe((()=>s("use",{href:"#down"},null,-1)))],we={class:"right"},Ie={key:0},xe=d("   "),Se={key:0,class:"container4 container"},je={class:"left"},Pe=["onClick"],Oe=[oe((()=>s("use",{href:"#down"},null,-1)))],qe={class:"right"},Ae={key:0},Ee=d("   "),Le={key:0,class:"container5 container"},Ue={class:"left"},$e={class:"right"},Be={key:0},Fe=d("   "),Ne={class:"bottom-btns"},Re=d("确认"),Ve=d("重置"),De={name:""},ze=w(Object.assign(De,{setup(o){const h=e([]),m=e([]),y=e([]),f=e([]),b=I(),k=(e,a)=>!(!e||!e.length)&&!!e.find((e=>e.type===a)),C=(e,a)=>{a.putAway?(document.getElementsByClassName(`${e}-model`)[0].classList.add("height-0"),a.putAway=!1):(document.getElementsByClassName(`${e}-model`)[0].classList.remove("height-0"),a.putAway=!0)},_=e=>{const a=m.value.includes(e.id);if(a&&"point"!==e.type){if(e.children){const a=q([e],"children","id");m.value=Array.from(new Set([...m.value,...a]))}w(e).forEach((e=>{const a=q([e],"children","id");m.value.filter((e=>a.includes(e))).length===a.length-1&&m.value.push(e.id)}))}if(!a&&"point"!==e.type&&e.children){const a=q([e],"children","id");m.value=m.value.filter((e=>!a.includes(e)))}},w=e=>{const a=[];for(;"-1"!==e.pid;)e=A(h.value,"children","id",e.pid)[0],a.push(e);return a},x=e=>{if(m.value.includes(e.id))return!1;const a=q([e],"children").filter((e=>"point"!==e.type)).map((e=>e.id));return!!m.value.filter((e=>a.includes(e))).length},P=async()=>{try{await j.roleFunctionEdit({roleId:b.query.roleId,functionIds:m.value}),E("角色权限修改成功")}catch(e){S(e)}};return a((()=>{(async()=>{try{const e=await j.getAllPublic();h.value=e.data,y.value=h.value.map((e=>e.id)),f.value.push(y.value[0])}catch(e){S(e)}})(),(async()=>{try{const e=await j.getSelectedFunctionIds(b.query.roleId);m.value=e.data}catch(e){S(e)}})()})),(e,a)=>{const o=g("el-checkbox"),y=g("el-checkbox-group"),f=g("el-scrollbar"),b=g("el-button");return l(),n("div",de,[u(f,{height:"calc(100vh - 300px)",style:{padding:"10px 24px 24px 24px"}},{default:v((()=>[u(y,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e)},{default:v((()=>[(l(!0),n(i,null,c(h.value,(e=>(l(),n(i,{key:e.id},[s("div",re,[u(o,{label:e.id,indeterminate:x(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",ue,[s("div",ve,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},me,8,he)):t("",!0),u(o,{label:e.id,indeterminate:x(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",ge,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",pe,[ye,u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),fe])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",be,[s("div",ke,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},_e,8,Ce)):t("",!0),u(o,{label:e.id,indeterminate:x(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",we,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",Ie,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),xe])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",Se,[s("div",je,[k(e.children,"menu")||k(e.children,"tab")?(l(),n("svg",{key:0,class:"iconpark-icon",onClick:a=>C(e.id,e)},Oe,8,Pe)):t("",!0),u(o,{label:e.id,indeterminate:x(e),onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","indeterminate","onChange"])]),s("div",qe,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",Ae,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),Ee])):t("",!0)],64)))),128))])])):t("",!0),s("div",{class:p(["model height-0",[`${e.id}-model`]])},[(l(!0),n(i,null,c(e.children,(e=>(l(),n(i,{key:e.id},["point"!==e.type?(l(),n("div",Le,[s("div",Ue,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"])]),s("div",$e,[(l(!0),n(i,null,c(e.children,((e,a)=>(l(),n(i,{key:a},["point"===e.type?(l(),n("div",Be,[u(o,{label:e.id,onChange:a=>_(e)},{default:v((()=>[d(r(e.name),1)])),_:2},1032,["label","onChange"]),Fe])):t("",!0)],64)))),128))])])):t("",!0)],64)))),128))],2)],64)))),128))],2)],64)))),128))],2)],64)))),128))],64)))),128))])),_:1},8,["modelValue"])])),_:1},8,["height"]),s("div",Ne,[u(b,{type:"primary",onClick:P},{default:v((()=>[Re])),_:1}),u(b,null,{default:v((()=>[Ve])),_:1})])])}}}),[["__scopeId","data-v-0a5af12b"]]),Ge=e=>(h("data-v-ea838dc6"),e=e(),m(),e),Me={class:"accomplish-container"},He={class:"breadcrumb"},Je=d(" 权限管理 "),Ke=d(" 权限配置 "),Qe={class:"title"},Te={class:"title-desc"},We=d(" 权限配置 "),Xe={class:"role"},Ye=Ge((()=>s("div",null,null,-1))),Ze={class:"custom-tabs"},ea={class:"function"},aa={key:0,class:"custom-data"},la={class:"item"},na=Ge((()=>s("div",{class:"item-label"},"默认数据权限",-1))),sa={class:"i"},ta={class:"item"},ia=Ge((()=>s("div",{class:"item-label"},"自定义数据权限",-1))),ca=d("编辑"),oa={class:"item"},da=Ge((()=>s("div",{class:"item-label"},null,-1))),ra={name:"PermissionSelect"},ua=w(Object.assign(ra,{setup(a){const i=L(),c=I(),o=e("first"),h=e(c.query.roleName),m=e([{name:"t-zgj-person.FunctionalPermissions",value:"first"},{name:"t-zgj-person.DataPermissions",value:"second"}]),p=e({roleId:""});p.value={id:c.query.roleId};const w=e([{label:"向上继承",msg:"可以查看下级部门员工创建数据"},{label:"仅自己",msg:"仅可以查看创建人自己的数据"}]),x=e(null),P=e([]);B.getSetting().then((e=>{const a="1"===e.data.userBaseAuth?0:1;x.value=w.value[a]}));(async()=>{try{const e=await j.getAllPublic();P.value=e.data}catch(e){S(e)}})();const O=()=>{i.go(-1)},q=e(["user","organ"]),A=e(!1),E=e([]),F=()=>{A.value=!0},N=e=>{},R=e({padding:"10px 0 0px 0px"});return(e,a)=>{const i=g("el-breadcrumb-item"),c=g("el-breadcrumb"),w=g("el-button");return l(),n("div",Me,[u(_,{Layout:"breadcrumb,title,custom,fixed",cardStyle:R.value},{breadcrumb:v((()=>[s("div",He,[u(c,{separator:"/"},{default:v((()=>[u(i,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:v((()=>[Je])),_:1}),u(i,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:v((()=>[Ke])),_:1})])),_:1})])])),title:v((()=>[s("div",Qe,[s("div",Te,[s("img",{class:"title-desc-img",src:C,alt:"",onClick:O}),We,s("span",Xe,"（"+r(h.value)+"）",1)]),Ye])])),noScroll:v((()=>[s("div",Ze,[u(U,{active:o.value,label:m.value,"onUpdate:active":a[0]||(a[0]=e=>o.value=e)},null,8,["active","label"])]),y(s("div",ea,[u(b(ze))],512),[[f,"first"===o.value]]),"second"===o.value?(l(),n("div",aa,[s("div",la,[na,s("div",null,[d(r(x.value.label)+" ",1),s("span",sa," （"+r(x.value.msg)+"） ",1)])]),s("div",ta,[ia,u(w,{type:"primary",onClick:F},{default:v((()=>[ca])),_:1})]),s("div",oa,[da,u(b(ce))])])):t("",!0)])),_:1},8,["cardStyle"]),A.value?(l(),k($,{key:0,show:A.value,"onUpdate:show":a[1]||(a[1]=e=>A.value=e),tabsShow:q.value,"onUpdate:searchSelected":N,searchSelected:E.value,editDeploy:"",apiModule:"systemOrganOrPerson",queryParams:p.value},null,8,["show","tabsShow","searchSelected","queryParams"])):t("",!0)])}}}),[["__scopeId","data-v-ea838dc6"]]);export{ua as default};
