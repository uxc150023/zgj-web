import{g as e,j as a,u as l,Q as t,a6 as s,a8 as i,a9 as n}from"./chunk-vform-d740b35c.js";import o from"./index-5b654134.js";import r from"./index-c94400aa.js";import{r as c,b as d,a9 as u,a1 as m,C as f,F as p,G as v,B as g,N as y,H as I,u as h,S as P,T as w,Q as b,J as x,P as k,U as D,_ as S,I as V,R as _,E as N,n as M,V as j,W as T}from"./chunk-element-plus-a77de3d2.js";import{_ as J}from"./back-bdc75944.js";import{_ as O}from"./step_next-7a8cf5a2.js";import{c as q}from"./Layout-e90710df.js";import{S as C}from"./JyStep-e8daeec8.js";import{_ as F}from"./index-2f43646f.js";import"./index-d761d72f.js";import"./home-back-d5b479fa.js";import"./logo-ad08cc7e.js";import"./request-util-79a78767.js";import"./main-673bace6.js";const L=e=>(j("data-v-5dd70f9f"),e=e(),T(),e),U={class:"Seal-application-fill-form"},Q={class:"breadcrumb"},z=_(" 用印申请 "),A=_(" 新建用印申请 "),B=_(" 新建用印申请 "),E=L((()=>I("div",null,null,-1))),H={class:"custom-buzhou"},G={class:"custom"},R={key:1},W={class:"PrintingProcess"},Y={class:"PrintingProcess-content"},K={class:"PrintingProcess-content-list-cont"},X={class:"PrintingProcess-content-list-cont-title"},Z=L((()=>I("img",{class:"PrintingProcess-content-list-cont-title-img",src:"/zgj-web/assets/calendar-67a958ae.svg",alt:""},null,-1))),$={class:"PrintingProcess-content-list-cont-title-span"},ee={class:"PrintingProcess-content-list-cont-list-name"},ae=L((()=>I("div",{class:"PrintingProcess-content-list-cont-list-icon"},[I("img",{class:"PrintingProcess-content-list-cont-list-icon-img",src:"/zgj-web/assets/tips-e93e6fe1.svg",alt:""})],-1))),le={class:"PrintingProcess-content-list-iocn"},te={key:0,class:"PrintingProcess-content-list-iocn-img",src:O,alt:""},se={key:0,class:"fixed"},ie={class:"ap-fixed"},ne=_("下一步"),oe=L((()=>I("span",{class:"ap-fixed-save-text"}," 保存模板 ",-1))),re=L((()=>I("div",{style:{width:"300px"}}," 模板可用于提高重复发起同种类型用印申请的填写效率，一种文件类型仅允许保存一个模板，保存后可在申请页面直接引用 ",-1))),ce=L((()=>I("i",{class:"ap-fixed-save-icon"},[I("svg",{class:"iconpark-icon"},[I("use",{href:"#icon4"})])],-1))),de={key:1,class:"fixed"},ue={class:"ap-fixed"},me=_("提交 "),fe=_("上一步"),pe=_(" 若当前文件类型已有模版则会覆盖，若当前文件类型没有模板则会创建，请问确定要保存吗？ "),ve=e({setup(e){const _=a(),j=l(),T=c(null),O=c(null),L=c(null),ve=c(null),ge=c(j.query.formVersionId),ye=c(null),Ie=c(!1),he=d({cache:{flowList:[{name:"填写表单信息",active:!0},{name:"确认审批流程",active:!1},{name:"完成",active:!1}],formData:{},optionData:{},SealformData:{},SealoptionData:{},PrintingProcess:{list:[{title:"盖前",list:[{name:"说明详情后续补上"}]},{title:"实时视频盖章",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖中",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖后",list:[{name:"说明详情后续补上"}]},{title:"归档",list:[{name:"说明详情后续补上"}]}]}}}),Pe=c(null),we=c("one"),be=c(null),xe=c([]),ke=c(null),De=c(!1),Se=c(null),Ve=c({}),_e=c(null),Ne=c({padding:"24px 0 24px 24px"}),Me=()=>{t.templateAdd({formVersionId:ge.value,templateName:Se.value.applyName,fileTypeId:Se.value.fileTypeId,templateValue:JSON.stringify(Se.value)}).then((e=>{N.success("保存模板成功"),De.value=!1})).catch((()=>{De.value=!1}))},je=()=>{De.value=!1};function Te(){_.go(-1)}function Je(){Pe.value.getFormData().then((e=>{he.cache.formData=e;const a=he.cache.flowList;a[0].active=!1,a[1].active=!0,he.cache.flowList=JSON.parse(JSON.stringify(a)),we.value="two",t.flowList({formMessageId:j.query.formMessageId,fileTypeId:e.fileTypeId}).then((e=>{e.data&&e.data.length&&(xe.value=e.data,ke.value=e.data[0].flowMessageId,ye.value=e.data[0].flowVersionId,Ce(e.data[0].modelId,e.data[0].definitionId))}))}))}const Oe=async()=>{Se.value=null;const e=await Pe.value.getFormData(!1);e.fileTypeId||e.applyName?(Se.value=e,De.value=!0):N.warning("单据名称和文件类型必填，否则不允许保存模板")};function qe(){const e=xe.value.find((e=>e.flowMessageId===ke.value));ye.value=e.flowVersionId,Ce(e.modelId,e.definitionId)}function Ce(e,a){T.value={modelId:e,definitionId:a},t.flowDetail({...T.value,edit:!0}).then((async e=>{_e.value=null,M((()=>{_e.value=e.data.data,M((()=>{Ve.value={height:document.getElementById("flow-designer-box").clientHeight+"px",overflow:"hidden"}}))}))}))}function Fe(){const e=he.cache.flowList;e[0].active=!0,e[1].active=!1,he.cache.flowList=JSON.parse(JSON.stringify(e)),we.value="one"}function Le(){if(!ke.value)return void N.warning("请选择审批流程");const e=n;let a={},l={};for(const t in he.cache.formData){e.indexOf(t)>-1?a={...a,[t]:he.cache.formData[t]}:l={...l,[t]:he.cache.formData[t]}}const s={modelId:T.value.modelId,definitionId:T.value.definitionId,instanceName:he.cache.formData.applyName,suggest:null,formData:{...he.cache.formData,formVersionId:ge.value,flowVersionId:ye.value,formMessageId:j.query.formMessageId,flowMessageId:ke.value},variable:{subType:O.value,instanceType:L.value}};Ie.value=!0,t.submit(s).then((e=>{t.add({formMessageId:j.query.formMessageId,formVersionId:ge.value,flowVersionId:ye.value,applyTypeId:O.value,sealUseTypeId:ve.value,flowMessageId:ke.value,gunsSysId:e.data.data.instanceId,customApplyField:"{}"===JSON.stringify(l)?null:l,...a}).then((()=>{_.replace({path:"/frontDesk/printControlManage/useSealManage/sealApplication/accomplish",query:{applyNo:he.cache.formData.applyNo}})})).finally((()=>{Ie.value=!1}))})).finally((()=>{Ie.value=!1}))}return u((()=>{j.query.useId?t.formQuery({formMessageId:j.query.formMessageId}).then((e=>{O.value=e.data.applyTypeId,L.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),t.templateView(j.query.useId).then((e=>{ge.value=e.data.formVersionId,Pe.value.setFormData(JSON.parse(e.data.templateValue)),M((()=>{Pe.value.setFieldValue("applyNo",s())}))}))})):t.formQuery({formMessageId:j.query.formMessageId}).then((e=>{O.value=e.data.applyTypeId,L.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),M((()=>{Pe.value.setFieldValue("applyNo",s())}))}))})),m((()=>{})),(e,a)=>{const l=f("el-breadcrumb-item"),t=f("el-breadcrumb"),s=r,n=f("el-option"),c=f("el-select"),d=o,u=f("el-scrollbar"),m=f("el-button"),_=f("el-tooltip"),N=i;return p(),v("div",U,[g(q,{Layout:"breadcrumb,title,custom,fixed",cardStyle:Ne.value},{breadcrumb:y((()=>[I("div",Q,[g(t,{separator:"/"},{default:y((()=>[g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:y((()=>[z])),_:1}),g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:y((()=>[A])),_:1})])),_:1})])])),title:y((()=>[I("div",{class:"title"},[I("div",{class:"title-desc"},[I("img",{class:"title-desc-img",src:J,alt:"",onClick:Te}),B]),E])])),custom:y((()=>[I("div",H,[g(C,{data:h(he).cache.flowList},null,8,["data"])]),g(u,{height:"calc(100vh - 300px)",style:{"padding-right":"24px"}},{default:y((()=>[I("div",G,[be.value?P((p(),b(s,{key:0,mode:"render",formJson:be.value,formData:h(he).cache.formData,optionData:h(he).cache.optionData,ref_key:"refFillFormInformation",ref:Pe},null,8,["formJson","formData","optionData"])),[[w,"one"===we.value]]):x("",!0),"two"===we.value?(p(),v("div",R,[g(d,{label:"审批流程"},{right:y((()=>[g(c,{modelValue:ke.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ke.value=e),placeholder:"请选择流程",onChange:qe},{default:y((()=>[(p(!0),v(k,null,D(xe.value,(e=>(p(),b(n,{key:e.flowMessageId,label:e.flowName,value:e.flowMessageId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),_e.value?(p(),b(F,S({key:0,id:"flow"},{readable:!0,mapable:!1,scroll:!1,scrollY:!1,top:"50"},{node:_e.value,wrapStyle:Ve.value}),null,16,["node","wrapStyle"])):x("",!0),I("div",W,[g(d,{label:"用印流程"}),I("div",Y,[(p(!0),v(k,null,D(h(he).cache.PrintingProcess.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list",key:a},[I("div",K,[I("div",X,[Z,I("span",$,V(e.title),1)]),(p(!0),v(k,null,D(e.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list-cont-list",key:a},[I("div",ee,V(e.name),1),ae])))),128))]),I("div",le,[a<h(he).cache.PrintingProcess.list.length-1?(p(),v("img",te)):x("",!0)])])))),128))])])])):x("",!0)])])),_:1})])),fixed:y((()=>["one"===we.value?(p(),v("div",se,[I("div",ie,[g(m,{type:"primary",onClick:Je},{default:y((()=>[ne])),_:1}),g(m,{class:"ap-fixed-save",onClick:Oe},{default:y((()=>[oe,g(_,{class:"box-item",effect:"dark",content:"",placement:"top"},{content:y((()=>[re])),default:y((()=>[ce])),_:1})])),_:1})])])):x("",!0),"two"===we.value?(p(),v("div",de,[I("div",ue,[g(m,{type:"primary",loading:Ie.value,onClick:Le},{default:y((()=>[me])),_:1},8,["loading"]),g(m,{onClick:Fe},{default:y((()=>[fe])),_:1})])])):x("",!0)])),_:1},8,["cardStyle"]),g(N,{modelValue:De.value,"onUpdate:modelValue":a[1]||(a[1]=e=>De.value=e),mode:1,onOnConfirm:Me,onOnCancel:je,title:"保存模版"},{default:y((()=>[pe])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5dd70f9f"]]);export{ve as default};
