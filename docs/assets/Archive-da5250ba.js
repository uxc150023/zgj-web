import{B as e,g as l,j as a,F as t,P as i,m as o,a3 as r,n as s}from"./chunk-vform-d740b35c.js";import{_ as n}from"./gengduo-caozuo-730fe1cb.js";import{J as p}from"./JyTable-d62bb35b.js";import{c as d}from"./JyTabs-726242c5.js";import{c}from"./documentsDetails-8b022303.js";import{d as m}from"./portion-e63dfdb7.js";import{r as h,b as u,a9 as v,a1 as f,C as y,F as b,G as w,B as A,N as F,H as g,u as k,P as T,U as S,Q as D,R as _,I as N,J as I,K as C,V as j,W as x}from"./chunk-element-plus-a77de3d2.js";import"./sangedian-6ea00dcf.js";import"./Layout-e90710df.js";import"./searchForm-96cc0cf8.js";import"./ketanchude-a94e84bc.js";import"./KDocumentTypeDialog-63de8919.js";import"./pagination-3c925a2b.js";import"./batch-6eb7c760.js";import"./index-d761d72f.js";/* empty css                                                               */import"./cha-kong-c10eac4e.js";import"./table-e0a114b8.js";/* empty css                                                                         */import"./yuan-hui-31c99901.js";/* empty css                                                                */const z=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",align:"center",width:150,show:!0,rankDisplayData:[{name:"文件归档"}]}],U=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",width:150,align:"center",show:!0,rankDisplayData:[{name:"文件归档"}]}],B=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"download",label:"文件下载",fixed:"right",align:"center","min-width":200,show:!0,rankDisplayData:[{name:"用印前"},{name:"用印中"},{name:"用印后"}]},{prop:"caozuo",label:"操作",fixed:"right","min-width":150,align:"center",show:!0,rankDisplayData:[{name:"补传"},{name:"申请重置"}]}],O=[{id:"searchKey",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"applyDate",label:"申请时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"fileTypeId",requestParams:"fileTypeIds",label:"文件类型",type:"derivable",inCommonUse:!1,defaultAttribute:{placeholder:"请选择",type:"fileType",multiple:!0,joinStr:","},options:[]},{id:"applyUser",requestParams:"applyUserId",label:"申请人",type:"derivable",defaultAttribute:{type:"user",multiple:!0,placeholder:"+申请人",joinStr:","},options:[],values:null},{id:"applyOrgan",requestParams:"applyOrganIds",label:"申请部门",type:"derivable",defaultAttribute:{type:"organ",multiple:!0,placeholder:"+申请部门",joinStr:","},options:[],values:null},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"useSealStatus",label:"用印状态",type:"checkButton",data:[{id:"1",name:"正常"},{id:"2",name:"异常"}]},{id:"onlyMyself",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],V=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],M=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],P={archiveInfo:l=>e({method:"GET",url:"/archive/info/"+l}),archiveFileFinish:l=>e({method:"POST",url:"/archive/file/finish",data:l}),archiveDelete:l=>e({method:"POST",url:"/archive/file/delete",params:l}),archiveFinish:l=>e({method:"POST",url:"/archive/finish",data:l}),archiveRestApply:l=>e({method:"POST",url:"/archive/reset/apply",params:l}),archiveRestCancel:l=>e({method:"POST",url:"/archive/reset/cancel",params:l}),archiveDownloadPack:l=>e({method:"get",url:"/archive/download/pack",params:l}),archiveDownloadPage:l=>e({method:"GET",url:"/archive/download/page",params:l}),archiveDownloadDelete:l=>e({method:"GET",url:"/archive/download/delete",params:l})},Y=e=>(j("data-v-812c00ea"),e=e(),x(),e),H={class:"PrintControlManagement-Archive"},R={class:"title"},Z=Y((()=>g("div",null,"文件归档",-1))),q={class:"title-more"},$=Y((()=>g("div",{class:"title-more-add"},null,-1))),J={key:0,class:"title-more-down"},K=Y((()=>g("img",{class:"button-icon",src:n,alt:"",srcset:""},null,-1))),E=Y((()=>g("span",null,"更多操作",-1))),G={class:"ap-box"},L=Y((()=>g("div",{class:"ap-cont-box-title-label"},"基本信息",-1))),W={class:"from-wrap"},Q=Y((()=>g("div",{class:"ap-cont-box-title-label"},"文件归档",-1))),X={key:0,class:"files-wrap content-wrap"},ee=Y((()=>g("span",null,"文件归档",-1))),le={class:"files-list"},ae={key:0,class:"add-file"},te=Y((()=>g("svg",{preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"",viewBox:"0 0 16 16"},[g("g",null,[g("g",{"fill-rule":"nonzero",fill:"#1985F5","data-follow-fill":"#1985F5"},[g("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),g("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),g("path",{d:"m3.19 5.003 1.29-1.408L7.061.757 7.755 0l.693.757 2.581 2.838 1.291 1.408H3.19ZM8.32 9.77l-.395.437h-.341l-.395-.437H8.32Z"}),g("path",{d:"M6.155 9.6v.608h3.2V9.6h-3.2Zm4.266 0v1.707H5.088V9.6H0V16h16V9.6h-5.579Zm1.312 5.184H9.6v-2.133h2.133v2.133Zm3.2 0H12.8v-2.133h2.133v2.133Z"})])])],-1))),ie=_(" 请添加归档文件 "),oe={class:"upload-file"},re={key:0},se=Y((()=>g("img",{src:"/zgj-web/assets/icon-pdf-2f424dcd.svg"},null,-1))),ne={key:1},pe=Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#folder"})],-1))),de={class:"archive-status"},ce={key:0,class:"archive-status-item"},me=[Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#finished"})],-1))),_(" 完成归档 ")],he={key:1,class:"archive-status-item"},ue=_("完成归档"),ve={key:1},fe=[Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#waiting-arvhices"})],-1))),Y((()=>g("span",null,"归档中（其他终端）",-1)))],ye={class:"files-add content-wrap"},be=Y((()=>g("span",null,"补充附件",-1))),we={class:"upload-archives-element"},Ae=Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#upload-file"})],-1))),Fe=_(" 添加附件 "),ge={class:"upload-files-list"},ke=["title"],Te={class:"file-size"},Se=Y((()=>g("div",{class:"file-status file-btn"},"已上传",-1))),De=Y((()=>g("div",{class:"file-view file-btn"},"预览",-1))),_e=Y((()=>g("div",{class:"file-down file-btn"},"下载",-1))),Ne=Y((()=>g("div",{class:"file-delete file-btn"},"删除",-1))),Ie=l({setup(e){const l=a(),n=h(!1),j=h("shallArchive"),x=h(null),Y=h(null),Ie=h({shallArchive:z,archiving:U,archived:B}),Ce=h({shallArchiveSearchForm:O,archivingSearchForm:V,archivedSearchForm:M}),je=u({show:!1,title:"文件归档"}),xe=u({cache:{},componentsTitle:{more:{data:[]}},componentsTabs:{data:[{label:"待归档",name:"shallArchive"},{label:"归档中",name:"archiving"},{label:"已归档",name:"archived"}]},componentsSearchForm:{data:Ce.value.shallArchiveSearchForm,butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"t-zgj-query",label:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"t-zgj-reset",label:"重置",type:"click",defaultAttribute:{plain:!0},style:{}}]},componentsTable:{header:Ie.value.shallArchive},componentsDocumentsDetails:{show:!1,visible:[{label:"用印详情",name:"Details-of-Printing"},{label:"审批流程",name:"approval-process"},{label:"领用记录",name:"Record-of-requisition"},{label:"操作记录",name:"operating-record"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[]},componentsArchiveForm:{useSealApplyId:"",fileTypeId:"",applyCode:"",applyName:"",archiveNo:"",readme:"",files:[],supplemenFiles:[]}});function ze(e,l,a,t){"useSealFileName"===l.property&&(xe.componentsDocumentsDetails.show=!0)}function Ue(){xe.componentsDocumentsDetails.show=!1}function Be(e){j.value=e,xe.componentsTable.header=Ie.value[e],"shallArchive"===e||"archiving"===e?xe.componentsTitle.more.data=[]:"archived"===e&&(xe.componentsTitle.more.data=[{name:"文件打包下载"},{name:"下载记录"}]),x.value.clickSubmit()}const Oe=(e,a,t,i)=>{"文件归档"===t.name&&(je.show=!0,P.archiveInfo(a.useSealApplyId).then((e=>{const l=e.data;xe.componentsArchiveForm.useSealApplyId=l.useSealApplyId,xe.componentsArchiveForm.fileTypeId=l.fileTypeId,xe.componentsArchiveForm.applyCode=l.useSealApplyNo,xe.componentsArchiveForm.applyName=l.useSealFileName,xe.componentsArchiveForm.files=[],xe.componentsArchiveForm.supplemenFiles=l.archiveAddFile,l.useSealFile.forEach((e=>{var l;xe.componentsArchiveForm.files.push({fileOriginName:e.fileOriginName,bizFileId:e.bizFileId,fileSize:(e.fileSizeByte/1024).toFixed(2)+"KB",type:e.archiveFile?2:-1,archiveAttachmentFileName:null==(l=e.archiveFile)?void 0:l.fileOriginName,isArchived:!!e.archiveFile})})),Y.value={useSealApplyId:l.useSealApplyId,useSealFileTypeId:l.fileTypeId,joinBizFileId:"",fileSourceType:"1"}}))),"补传"===t.name&&(je.show=!0,xe.ArchiveFiles=[]),"申请重置"===t.name&&l.push({name:"ArchiveReset"})};function Ve(e){const l=xe.componentsArchiveForm.files.findIndex((l=>l.bizFileId===e.data.joinBizFileId));l>-1&&(xe.componentsArchiveForm.files[l].type=2,xe.componentsArchiveForm.files[l].archiveAttachmentFileName=e.data.fileOriginName,xe.componentsArchiveForm.files[l].isArchived=!1,xe.componentsArchiveForm.files[l].fileSourceType=e.data.fileSourceType,xe.componentsArchiveForm.files[l].bizFileId=e.data.bizFileId)}function Me(e){e.data.fileUrl=e.data.fileUrl?t+e.data.fileUrl:"",xe.componentsArchiveForm.supplemenFiles.push(e.data)}function Pe(){const e=xe.componentsArchiveForm.files.filter((e=>e.isArchived)).length;e&&e===xe.componentsArchiveForm.files.length?P.archiveFinish({useSealApplyId:xe.componentsArchiveForm.useSealApplyId,archiveNo:xe.componentsArchiveForm.archiveNo,readme:xe.componentsArchiveForm.readme}).then((()=>{je.show=!1,r("归档成功"),x.value.reloadData()})):o("请先完成文件归档")}function Ye(){xe.componentsArchiveForm.archiveNo="",xe.componentsArchiveForm.readme=""}return v((()=>{})),f((()=>{})),(e,l)=>{const a=y("el-button"),o=y("el-dropdown-item"),r=y("el-dropdown-menu"),h=y("el-dropdown"),u=y("el-input"),v=y("el-form-item"),f=y("el-col"),z=y("el-row"),U=y("el-form"),B=y("el-upload"),O=s;return b(),w("div",H,[A(p,{url:`/archive/page/${j.value}`,ref_key:"jyTable",ref:x,hasTabs:"",componentsSearchForm:k(xe).componentsSearchForm,componentsTableHeader:k(xe).componentsTable.header,componentsBatch:k(xe).componentsBatch,tableClick:"useSealFileName",onCellClick:ze,onCustomClick:Oe,onClickBatchButton:e.clickBatchButton},{title:F((()=>[g("div",R,[Z,g("div",q,[$,k(xe).componentsTitle.more.data.length>0?(b(),w("div",J,[A(h,null,{dropdown:F((()=>[A(r,null,{default:F((()=>[(b(!0),w(T,null,S(k(xe).componentsTitle.more.data,((l,a)=>(b(),D(o,{key:a,onClick:a=>e.moreClick(l)},{default:F((()=>[_(N(l.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:F((()=>[A(a,null,{default:F((()=>[K,E])),_:1})])),_:1})])):I("",!0)])])])),tabs:F((()=>[g("div",null,[A(d,{activeName:j.value,data:k(xe).componentsTabs.data,onTabChange:Be},null,8,["activeName","data"])])])),_:1},8,["url","componentsSearchForm","componentsTableHeader","componentsBatch","onClickBatchButton"]),g("div",G,[A(c,{show:k(xe).componentsDocumentsDetails.show,visible:k(xe).componentsDocumentsDetails.visible,onClickClose:Ue},null,8,["show","visible"])]),A(O,{"onUpdate:show":l[4]||(l[4]=e=>k(je).show=e),show:k(je).show,title:"文件归档",centerBtn:"",draggable:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),onClose:Ye,onConfirm:Pe},{default:F((()=>[A(m,null,{title:F((()=>[L])),content:F((()=>[g("div",W,[A(U,{"label-width":"70px","label-position":"left"},{default:F((()=>[A(z,{gutter:15},{default:F((()=>[A(f,{span:12},{default:F((()=>[A(v,{label:"单据编号",prop:"applyCode"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.applyCode,"onUpdate:modelValue":l[0]||(l[0]=e=>k(xe).componentsArchiveForm.applyCode=e),disabled:"",type:"text",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:12},{default:F((()=>[A(v,{label:"单据名称",prop:"applyName"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.applyName,"onUpdate:modelValue":l[1]||(l[1]=e=>k(xe).componentsArchiveForm.applyName=e),disabled:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:24},{default:F((()=>[A(v,{label:"档案字号",prop:"archiveNo"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.archiveNo,"onUpdate:modelValue":l[2]||(l[2]=e=>k(xe).componentsArchiveForm.archiveNo=e),placeholder:"请输入",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:24},{default:F((()=>[A(v,{label:"归档备注",prop:"readme"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.readme,"onUpdate:modelValue":l[3]||(l[3]=e=>k(xe).componentsArchiveForm.readme=e),type:"textarea",placeholder:"请输入",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1}),A(m,null,{title:F((()=>[Q])),content:F((()=>[k(xe).componentsArchiveForm.files.length>0?(b(),w("div",X,[ee,g("div",le,[(b(!0),w(T,null,S(k(xe).componentsArchiveForm.files,((e,l)=>(b(),w("div",{class:"files-item",key:l},[g("div",null,N(e.fileOriginName),1),e.type<2?(b(),w("div",ae,[A(B,{ref_for:!0,ref:"upload",class:"upload-demo",action:`${k(t)}/archive/file/upload`,limit:1,data:{useSealApplyId:k(xe).componentsArchiveForm.useSealApplyId,useSealFileTypeId:k(xe).componentsArchiveForm.fileTypeId,joinBizFileId:e.bizFileId,fileSourceType:"1"},"on-success":Ve,"show-file-list":!1},{trigger:F((()=>[te,ie])),_:2},1032,["action","data"])])):I("",!0),2==e.type?(b(),w("div",{key:1,class:C(["view-file",{special:"1"===e.fileSourceType}])},[g("div",oe,[e.isArchived?(b(),w("div",re,[se,_(N(e.archiveAttachmentFileName)+"（"+N(e.fileSize)+"） ",1)])):(b(),w("div",ne,[pe,_(" "+N(e.archiveAttachmentFileName),1)]))]),g("div",de,[e.isArchived?(b(),w("div",ce,me)):(b(),w("div",he,["1"===e.fileSourceType?(b(),D(a,{key:0,style:{"margin-right":"20px"},type:"primary",onClick:e=>function(e){P.archiveFileFinish({bizFileId:xe.componentsArchiveForm.files[e].bizFileId}).then((()=>{xe.componentsArchiveForm.files[e].isArchived=!0,xe.componentsArchiveForm.files[e].fileSourceType=null,x.value.reloadData()}))}(l)},{default:F((()=>[ue])),_:2},1032,["onClick"])):(b(),w("div",ve,fe))]))])],2)):I("",!0)])))),128))])])):I("",!0),g("div",ye,[be,g("div",we,[A(B,{ref:"upload",class:"upload-demo",action:`${k(t)}/archive/file/upload/add`,limit:1,data:Y.value,"show-file-list":!1,"on-success":Me},{trigger:F((()=>[Ae,Fe])),_:1},8,["action","data"]),g("div",ge,[(b(!0),w(T,null,S(k(xe).componentsArchiveForm.supplemenFiles,((e,l)=>(b(),w("div",{class:"upload-file-item",key:l},[g("div",{class:"file-name",title:e.fileOriginName},N(e.fileOriginName),9,ke),g("div",Te,N((e.fileSizeByte/1024).toFixed(2)+"KB"),1),Se,De,_e,Ne])))),128))])])])])),_:1})])),_:1},8,["show","confirmText","concelText"]),n.value?(b(),D(k(i),{key:0,show:n.value,"onUpdate:show":l[5]||(l[5]=e=>n.value=e)},null,8,["show"])):I("",!0)])}}},[["__scopeId","data-v-812c00ea"]]);export{Ie as default};
