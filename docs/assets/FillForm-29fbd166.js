import{g as e,j as a,u as l,Q as t,a6 as s,a8 as n,a9 as i}from"./chunk-vform-ec6574e8.js";import o from"./index-a02cc9a9.js";import r from"./index-c9b91a43.js";import{a as c,at as d,a9 as u,d as m,aQ as f,W as p,X as v,ap as g,ai as y,Y as I,u as h,aj as P,ak as w,ah as b,am as x,a3 as k,aE as D,af as N,ao as S,an as V,n as _,ba as j,bb as M}from"./chunk-ant-design-vue-a1de3c57.js";import{_ as T}from"./back-bdc75944.js";import{_ as J}from"./step_next-7a8cf5a2.js";import{c as O}from"./Layout-58d8fae6.js";import{S as q}from"./JyStep-84b76003.js";import{_ as C}from"./index-09e205e2.js";import{E as L}from"./chunk-element-plus-636450f3.js";import"./index-bd96bee1.js";import"./home-back-d5b479fa.js";import"./logo-ad08cc7e.js";import"./request-util-82325ac7.js";const F=e=>(j("data-v-5dd70f9f"),e=e(),M(),e),Q={class:"Seal-application-fill-form"},U={class:"breadcrumb"},z=V(" 用印申请 "),A=V(" 新建用印申请 "),E=V(" 新建用印申请 "),Y=F((()=>I("div",null,null,-1))),B={class:"custom-buzhou"},G={class:"custom"},H={key:1},R={class:"PrintingProcess"},W={class:"PrintingProcess-content"},X={class:"PrintingProcess-content-list-cont"},K={class:"PrintingProcess-content-list-cont-title"},Z=F((()=>I("img",{class:"PrintingProcess-content-list-cont-title-img",src:"/zgj-web/assets/calendar-67a958ae.svg",alt:""},null,-1))),$={class:"PrintingProcess-content-list-cont-title-span"},ee={class:"PrintingProcess-content-list-cont-list-name"},ae=F((()=>I("div",{class:"PrintingProcess-content-list-cont-list-icon"},[I("img",{class:"PrintingProcess-content-list-cont-list-icon-img",src:"/zgj-web/assets/tips-e93e6fe1.svg",alt:""})],-1))),le={class:"PrintingProcess-content-list-iocn"},te={key:0,class:"PrintingProcess-content-list-iocn-img",src:J,alt:""},se={key:0,class:"fixed"},ne={class:"ap-fixed"},ie=V("下一步"),oe=F((()=>I("span",{class:"ap-fixed-save-text"}," 保存模板 ",-1))),re=F((()=>I("div",{style:{width:"300px"}}," 模板可用于提高重复发起同种类型用印申请的填写效率，一种文件类型仅允许保存一个模板，保存后可在申请页面直接引用 ",-1))),ce=F((()=>I("i",{class:"ap-fixed-save-icon"},[I("svg",{class:"iconpark-icon"},[I("use",{href:"#icon4"})])],-1))),de={key:1,class:"fixed"},ue={class:"ap-fixed"},me=V("提交 "),fe=V("上一步"),pe=V(" 若当前文件类型已有模版则会覆盖，若当前文件类型没有模板则会创建，请问确定要保存吗？ "),ve=e({setup(e){const V=a(),j=l(),M=c(null),J=c(null),F=c(null),ve=c(null),ge=c(j.query.formVersionId),ye=c(null),Ie=c(!1),he=d({cache:{flowList:[{name:"填写表单信息",active:!0},{name:"确认审批流程",active:!1},{name:"完成",active:!1}],formData:{},optionData:{},SealformData:{},SealoptionData:{},PrintingProcess:{list:[{title:"盖前",list:[{name:"说明详情后续补上"}]},{title:"实时视频盖章",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖中",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖后",list:[{name:"说明详情后续补上"}]},{title:"归档",list:[{name:"说明详情后续补上"}]}]}}}),Pe=c(null),we=c("one"),be=c(null),xe=c([]),ke=c(null),De=c(!1),Ne=c(null),Se=c({}),Ve=c(null),_e=c({padding:"24px 0 24px 24px"}),je=()=>{t.templateAdd({formVersionId:ge.value,templateName:Ne.value.applyName,fileTypeId:Ne.value.fileTypeId,templateValue:JSON.stringify(Ne.value)}).then((e=>{L.success("保存模板成功"),De.value=!1})).catch((()=>{De.value=!1}))},Me=()=>{De.value=!1};function Te(){V.go(-1)}function Je(){Pe.value.getFormData().then((e=>{he.cache.formData=e;const a=he.cache.flowList;a[0].active=!1,a[1].active=!0,he.cache.flowList=JSON.parse(JSON.stringify(a)),we.value="two",t.flowList({formMessageId:j.query.formMessageId,fileTypeId:e.fileTypeId}).then((e=>{e.data&&e.data.length&&(xe.value=e.data,ke.value=e.data[0].flowMessageId,ye.value=e.data[0].flowVersionId,Ce(e.data[0].modelId,e.data[0].definitionId))}))}))}const Oe=async()=>{Ne.value=null;const e=await Pe.value.getFormData(!1);e.fileTypeId||e.applyName?(Ne.value=e,De.value=!0):L.warning("单据名称和文件类型必填，否则不允许保存模板")};function qe(){const e=xe.value.find((e=>e.flowMessageId===ke.value));ye.value=e.flowVersionId,Ce(e.modelId,e.definitionId)}function Ce(e,a){M.value={modelId:e,definitionId:a},t.flowDetail({...M.value,edit:!0}).then((async e=>{Ve.value=null,_((()=>{Ve.value=e.data.data,_((()=>{Se.value={height:document.getElementById("flow-designer-box").clientHeight+"px",overflow:"hidden"}}))}))}))}function Le(){const e=he.cache.flowList;e[0].active=!0,e[1].active=!1,he.cache.flowList=JSON.parse(JSON.stringify(e)),we.value="one"}function Fe(){if(!ke.value)return void L.warning("请选择审批流程");const e=i;let a={},l={};for(const t in he.cache.formData){e.indexOf(t)>-1?a={...a,[t]:he.cache.formData[t]}:l={...l,[t]:he.cache.formData[t]}}const s={modelId:M.value.modelId,definitionId:M.value.definitionId,instanceName:he.cache.formData.applyName,suggest:null,formData:{...he.cache.formData,formVersionId:ge.value,flowVersionId:ye.value,formMessageId:j.query.formMessageId,flowMessageId:ke.value},variable:{subType:J.value,instanceType:F.value}};Ie.value=!0,t.submit(s).then((e=>{t.add({formMessageId:j.query.formMessageId,formVersionId:ge.value,flowVersionId:ye.value,applyTypeId:J.value,sealUseTypeId:ve.value,flowMessageId:ke.value,gunsSysId:e.data.data.instanceId,customApplyField:"{}"===JSON.stringify(l)?null:l,...a}).then((()=>{V.replace({path:"/frontDesk/printControlManage/useSealManage/sealApplication/accomplish",query:{applyNo:he.cache.formData.applyNo}})})).finally((()=>{Ie.value=!1}))})).finally((()=>{Ie.value=!1}))}return u((()=>{j.query.useId?t.formQuery({formMessageId:j.query.formMessageId}).then((e=>{J.value=e.data.applyTypeId,F.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),t.templateView(j.query.useId).then((e=>{ge.value=e.data.formVersionId,Pe.value.setFormData(JSON.parse(e.data.templateValue)),_((()=>{Pe.value.setFieldValue("applyNo",s())}))}))})):t.formQuery({formMessageId:j.query.formMessageId}).then((e=>{J.value=e.data.applyTypeId,F.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),_((()=>{Pe.value.setFieldValue("applyNo",s())}))}))})),m((()=>{})),(e,a)=>{const l=f("el-breadcrumb-item"),t=f("el-breadcrumb"),s=r,i=f("el-option"),c=f("el-select"),d=o,u=f("el-scrollbar"),m=f("el-button"),V=f("el-tooltip"),_=n;return p(),v("div",Q,[g(O,{Layout:"breadcrumb,title,custom,fixed",cardStyle:_e.value},{breadcrumb:y((()=>[I("div",U,[g(t,{separator:"/"},{default:y((()=>[g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:y((()=>[z])),_:1}),g(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:y((()=>[A])),_:1})])),_:1})])])),title:y((()=>[I("div",{class:"title"},[I("div",{class:"title-desc"},[I("img",{class:"title-desc-img",src:T,alt:"",onClick:Te}),E]),Y])])),custom:y((()=>[I("div",B,[g(q,{data:h(he).cache.flowList},null,8,["data"])]),g(u,{height:"calc(100vh - 300px)",style:{"padding-right":"24px"}},{default:y((()=>[I("div",G,[be.value?P((p(),b(s,{key:0,mode:"render",formJson:be.value,formData:h(he).cache.formData,optionData:h(he).cache.optionData,ref_key:"refFillFormInformation",ref:Pe},null,8,["formJson","formData","optionData"])),[[w,"one"===we.value]]):x("",!0),"two"===we.value?(p(),v("div",H,[g(d,{label:"审批流程"},{right:y((()=>[g(c,{modelValue:ke.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ke.value=e),placeholder:"请选择流程",onChange:qe},{default:y((()=>[(p(!0),v(k,null,D(xe.value,(e=>(p(),b(i,{key:e.flowMessageId,label:e.flowName,value:e.flowMessageId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Ve.value?(p(),b(C,N({key:0,id:"flow"},{readable:!0,mapable:!1,scroll:!1,scrollY:!1,top:"50"},{node:Ve.value,wrapStyle:Se.value}),null,16,["node","wrapStyle"])):x("",!0),I("div",R,[g(d,{label:"用印流程"}),I("div",W,[(p(!0),v(k,null,D(h(he).cache.PrintingProcess.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list",key:a},[I("div",X,[I("div",K,[Z,I("span",$,S(e.title),1)]),(p(!0),v(k,null,D(e.list,((e,a)=>(p(),v("div",{class:"PrintingProcess-content-list-cont-list",key:a},[I("div",ee,S(e.name),1),ae])))),128))]),I("div",le,[a<h(he).cache.PrintingProcess.list.length-1?(p(),v("img",te)):x("",!0)])])))),128))])])])):x("",!0)])])),_:1})])),fixed:y((()=>["one"===we.value?(p(),v("div",se,[I("div",ne,[g(m,{type:"primary",onClick:Je},{default:y((()=>[ie])),_:1}),g(m,{class:"ap-fixed-save",onClick:Oe},{default:y((()=>[oe,g(V,{class:"box-item",effect:"dark",content:"",placement:"top"},{content:y((()=>[re])),default:y((()=>[ce])),_:1})])),_:1})])])):x("",!0),"two"===we.value?(p(),v("div",de,[I("div",ue,[g(m,{type:"primary",loading:Ie.value,onClick:Fe},{default:y((()=>[me])),_:1},8,["loading"]),g(m,{onClick:Le},{default:y((()=>[fe])),_:1})])])):x("",!0)])),_:1},8,["cardStyle"]),g(_,{modelValue:De.value,"onUpdate:modelValue":a[1]||(a[1]=e=>De.value=e),mode:1,onOnConfirm:je,onOnCancel:Me,title:"保存模版"},{default:y((()=>[pe])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5dd70f9f"]]);export{ve as default};
