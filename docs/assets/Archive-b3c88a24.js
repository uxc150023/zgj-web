import{a7 as e,_ as l,I as a,v as t,h as i,j as o,k as r,r as s,o as n,c as p,a as d,w as c,m,u as h,F as u,e as v,f,g as y,t as b,l as w,ab as A,p as F,ai as g,K as k,cv as T,M as S,y as D,z as _}from"./main-e75bd94c.js";import{_ as N}from"./gengduo-caozuo-730fe1cb.js";import{J as I}from"./JyTable-735e5f88.js";import{c as C}from"./JyTabs-82aef442.js";import{c as j}from"./documentsDetails-e4b559a6.js";import{d as x}from"./portion-ad7469a7.js";import"./sangedian-6ea00dcf.js";import"./Layout-a5f6ee71.js";import"./searchForm-6ca4b4e4.js";import"./ketanchude-a94e84bc.js";import"./KDocumentTypeDialog-6b47a1ba.js";import"./pagination-10abb664.js";import"./batch-99f4afc3.js";import"./index-7c7937e4.js";/* empty css                                                               */import"./cha-kong-c10eac4e.js";import"./table-d1366238.js";/* empty css                                                                         */import"./yuan-hui-31c99901.js";/* empty css                                                                */const z=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",align:"center",width:150,show:!0,rankDisplayData:[{name:"文件归档"}]}],U=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",width:150,align:"center",show:!0,rankDisplayData:[{name:"文件归档"}]}],B=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"download",label:"文件下载",fixed:"right",align:"center","min-width":200,show:!0,rankDisplayData:[{name:"用印前"},{name:"用印中"},{name:"用印后"}]},{prop:"caozuo",label:"操作",fixed:"right","min-width":150,align:"center",show:!0,rankDisplayData:[{name:"补传"},{name:"申请重置"}]}],M=[{id:"searchKey",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"applyDate",label:"申请时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"fileTypeId",requestParams:"fileTypeIds",label:"文件类型",type:"derivable",inCommonUse:!1,defaultAttribute:{placeholder:"请选择",type:"fileType",multiple:!0,joinStr:","},options:[]},{id:"applyUser",requestParams:"applyUserId",label:"申请人",type:"derivable",defaultAttribute:{type:"user",multiple:!0,placeholder:"+申请人",joinStr:","},options:[],values:null},{id:"applyOrgan",requestParams:"applyOrganIds",label:"申请部门",type:"derivable",defaultAttribute:{type:"organ",multiple:!0,placeholder:"+申请部门",joinStr:","},options:[],values:null},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"useSealStatus",label:"用印状态",type:"checkButton",data:[{id:"1",name:"正常"},{id:"2",name:"异常"}]},{id:"onlyMyself",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],O=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],V=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],P={archiveInfo:l=>e({method:"GET",url:"/archive/info/"+l}),archiveFileFinish:l=>e({method:"POST",url:"/archive/file/finish",data:l}),archiveDelete:l=>e({method:"POST",url:"/archive/file/delete",params:l}),archiveFinish:l=>e({method:"POST",url:"/archive/finish",data:l}),archiveRestApply:l=>e({method:"POST",url:"/archive/reset/apply",params:l}),archiveRestCancel:l=>e({method:"POST",url:"/archive/reset/cancel",params:l}),archiveDownloadPack:l=>e({method:"get",url:"/archive/download/pack",params:l}),archiveDownloadPage:l=>e({method:"GET",url:"/archive/download/page",params:l}),archiveDownloadDelete:l=>e({method:"GET",url:"/archive/download/delete",params:l})},Y=e=>(D("data-v-812c00ea"),e=e(),_(),e),H={class:"PrintControlManagement-Archive"},Z={class:"title"},q=Y((()=>m("div",null,"文件归档",-1))),R={class:"title-more"},J=Y((()=>m("div",{class:"title-more-add"},null,-1))),K={key:0,class:"title-more-down"},$=Y((()=>m("img",{class:"button-icon",src:N,alt:"",srcset:""},null,-1))),E=Y((()=>m("span",null,"更多操作",-1))),G={class:"ap-box"},L=Y((()=>m("div",{class:"ap-cont-box-title-label"},"基本信息",-1))),Q={class:"from-wrap"},W=Y((()=>m("div",{class:"ap-cont-box-title-label"},"文件归档",-1))),X={key:0,class:"files-wrap content-wrap"},ee=Y((()=>m("span",null,"文件归档",-1))),le={class:"files-list"},ae={key:0,class:"add-file"},te=Y((()=>m("svg",{preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"",viewBox:"0 0 16 16"},[m("g",null,[m("g",{"fill-rule":"nonzero",fill:"#1985F5","data-follow-fill":"#1985F5"},[m("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),m("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),m("path",{d:"m3.19 5.003 1.29-1.408L7.061.757 7.755 0l.693.757 2.581 2.838 1.291 1.408H3.19ZM8.32 9.77l-.395.437h-.341l-.395-.437H8.32Z"}),m("path",{d:"M6.155 9.6v.608h3.2V9.6h-3.2Zm4.266 0v1.707H5.088V9.6H0V16h16V9.6h-5.579Zm1.312 5.184H9.6v-2.133h2.133v2.133Zm3.2 0H12.8v-2.133h2.133v2.133Z"})])])],-1))),ie=y(" 请添加归档文件 "),oe={class:"upload-file"},re={key:0},se=Y((()=>m("img",{src:"/zgj-web/assets/icon-pdf-2f424dcd.svg"},null,-1))),ne={key:1},pe=Y((()=>m("svg",{class:"iconpark-icon"},[m("use",{href:"#folder"})],-1))),de={class:"archive-status"},ce={key:0,class:"archive-status-item"},me=[Y((()=>m("svg",{class:"iconpark-icon"},[m("use",{href:"#finished"})],-1))),y(" 完成归档 ")],he={key:1,class:"archive-status-item"},ue=y("完成归档"),ve={key:1},fe=[Y((()=>m("svg",{class:"iconpark-icon"},[m("use",{href:"#waiting-arvhices"})],-1))),Y((()=>m("span",null,"归档中（其他终端）",-1)))],ye={class:"files-add content-wrap"},be=Y((()=>m("span",null,"补充附件",-1))),we={class:"upload-archives-element"},Ae=Y((()=>m("svg",{class:"iconpark-icon"},[m("use",{href:"#upload-file"})],-1))),Fe=y(" 添加附件 "),ge={class:"upload-files-list"},ke=["title"],Te={class:"file-size"},Se=Y((()=>m("div",{class:"file-status file-btn"},"已上传",-1))),De=Y((()=>m("div",{class:"file-view file-btn"},"预览",-1))),_e=Y((()=>m("div",{class:"file-down file-btn"},"下载",-1))),Ne=Y((()=>m("div",{class:"file-delete file-btn"},"删除",-1))),Ie=l({setup(e){const l=a(),D=t(!1),_=t("shallArchive"),N=t(null),Y=t(null),Ie=t({shallArchive:z,archiving:U,archived:B}),Ce=t({shallArchiveSearchForm:M,archivingSearchForm:O,archivedSearchForm:V}),je=i({show:!1,title:"文件归档"}),xe=i({cache:{},componentsTitle:{more:{data:[]}},componentsTabs:{data:[{label:"待归档",name:"shallArchive"},{label:"归档中",name:"archiving"},{label:"已归档",name:"archived"}]},componentsSearchForm:{data:Ce.value.shallArchiveSearchForm,butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"t-zgj-query",label:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"t-zgj-reset",label:"重置",type:"click",defaultAttribute:{plain:!0},style:{}}]},componentsTable:{header:Ie.value.shallArchive},componentsDocumentsDetails:{show:!1,visible:[{label:"用印详情",name:"Details-of-Printing"},{label:"审批流程",name:"approval-process"},{label:"领用记录",name:"Record-of-requisition"},{label:"操作记录",name:"operating-record"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[]},componentsArchiveForm:{useSealApplyId:"",fileTypeId:"",applyCode:"",applyName:"",archiveNo:"",readme:"",files:[],supplemenFiles:[]}});function ze(e,l,a,t){"useSealFileName"===l.property&&(xe.componentsDocumentsDetails.show=!0)}function Ue(){xe.componentsDocumentsDetails.show=!1}function Be(e){_.value=e,xe.componentsTable.header=Ie.value[e],"shallArchive"===e||"archiving"===e?xe.componentsTitle.more.data=[]:"archived"===e&&(xe.componentsTitle.more.data=[{name:"文件打包下载"},{name:"下载记录"}]),N.value.clickSubmit()}const Me=(e,a,t,i)=>{"文件归档"===t.name&&(je.show=!0,P.archiveInfo(a.useSealApplyId).then((e=>{const l=e.data;xe.componentsArchiveForm.useSealApplyId=l.useSealApplyId,xe.componentsArchiveForm.fileTypeId=l.fileTypeId,xe.componentsArchiveForm.applyCode=l.useSealApplyNo,xe.componentsArchiveForm.applyName=l.useSealFileName,xe.componentsArchiveForm.files=[],xe.componentsArchiveForm.supplemenFiles=l.archiveAddFile,l.useSealFile.forEach((e=>{var l;xe.componentsArchiveForm.files.push({fileOriginName:e.fileOriginName,bizFileId:e.bizFileId,fileSize:(e.fileSizeByte/1024).toFixed(2)+"KB",type:e.archiveFile?2:-1,archiveAttachmentFileName:null==(l=e.archiveFile)?void 0:l.fileOriginName,isArchived:!!e.archiveFile})})),Y.value={useSealApplyId:l.useSealApplyId,useSealFileTypeId:l.fileTypeId,joinBizFileId:"",fileSourceType:"1"}}))),"补传"===t.name&&(je.show=!0,xe.ArchiveFiles=[]),"申请重置"===t.name&&l.push({name:"ArchiveReset"})};function Oe(e){const l=xe.componentsArchiveForm.files.findIndex((l=>l.bizFileId===e.data.joinBizFileId));l>-1&&(xe.componentsArchiveForm.files[l].type=2,xe.componentsArchiveForm.files[l].archiveAttachmentFileName=e.data.fileOriginName,xe.componentsArchiveForm.files[l].isArchived=!1,xe.componentsArchiveForm.files[l].fileSourceType=e.data.fileSourceType,xe.componentsArchiveForm.files[l].bizFileId=e.data.bizFileId)}function Ve(e){e.data.fileUrl=e.data.fileUrl?A+e.data.fileUrl:"",xe.componentsArchiveForm.supplemenFiles.push(e.data)}function Pe(){const e=xe.componentsArchiveForm.files.filter((e=>e.isArchived)).length;e&&e===xe.componentsArchiveForm.files.length?P.archiveFinish({useSealApplyId:xe.componentsArchiveForm.useSealApplyId,archiveNo:xe.componentsArchiveForm.archiveNo,readme:xe.componentsArchiveForm.readme}).then((()=>{je.show=!1,T("归档成功"),N.value.reloadData()})):k("请先完成文件归档")}function Ye(){xe.componentsArchiveForm.archiveNo="",xe.componentsArchiveForm.readme=""}return o((()=>{})),r((()=>{})),(e,l)=>{const a=s("el-button"),t=s("el-dropdown-item"),i=s("el-dropdown-menu"),o=s("el-dropdown"),r=s("el-input"),k=s("el-form-item"),T=s("el-col"),z=s("el-row"),U=s("el-form"),B=s("el-upload"),M=S;return n(),p("div",H,[d(I,{url:`/archive/page/${_.value}`,ref_key:"jyTable",ref:N,hasTabs:"",componentsSearchForm:h(xe).componentsSearchForm,componentsTableHeader:h(xe).componentsTable.header,componentsBatch:h(xe).componentsBatch,tableClick:"useSealFileName",onCellClick:ze,onCustomClick:Me,onClickBatchButton:e.clickBatchButton},{title:c((()=>[m("div",Z,[q,m("div",R,[J,h(xe).componentsTitle.more.data.length>0?(n(),p("div",K,[d(o,null,{dropdown:c((()=>[d(i,null,{default:c((()=>[(n(!0),p(u,null,v(h(xe).componentsTitle.more.data,((l,a)=>(n(),f(t,{key:a,onClick:a=>e.moreClick(l)},{default:c((()=>[y(b(l.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:c((()=>[d(a,null,{default:c((()=>[$,E])),_:1})])),_:1})])):w("",!0)])])])),tabs:c((()=>[m("div",null,[d(C,{activeName:_.value,data:h(xe).componentsTabs.data,onTabChange:Be},null,8,["activeName","data"])])])),_:1},8,["url","componentsSearchForm","componentsTableHeader","componentsBatch","onClickBatchButton"]),m("div",G,[d(j,{show:h(xe).componentsDocumentsDetails.show,visible:h(xe).componentsDocumentsDetails.visible,onClickClose:Ue},null,8,["show","visible"])]),d(M,{"onUpdate:show":l[4]||(l[4]=e=>h(je).show=e),show:h(je).show,title:"文件归档",centerBtn:"",draggable:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),onClose:Ye,onConfirm:Pe},{default:c((()=>[d(x,null,{title:c((()=>[L])),content:c((()=>[m("div",Q,[d(U,{"label-width":"70px","label-position":"left"},{default:c((()=>[d(z,{gutter:15},{default:c((()=>[d(T,{span:12},{default:c((()=>[d(k,{label:"单据编号",prop:"applyCode"},{default:c((()=>[d(r,{modelValue:h(xe).componentsArchiveForm.applyCode,"onUpdate:modelValue":l[0]||(l[0]=e=>h(xe).componentsArchiveForm.applyCode=e),disabled:"",type:"text",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),d(T,{span:12},{default:c((()=>[d(k,{label:"单据名称",prop:"applyName"},{default:c((()=>[d(r,{modelValue:h(xe).componentsArchiveForm.applyName,"onUpdate:modelValue":l[1]||(l[1]=e=>h(xe).componentsArchiveForm.applyName=e),disabled:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),d(T,{span:24},{default:c((()=>[d(k,{label:"档案字号",prop:"archiveNo"},{default:c((()=>[d(r,{modelValue:h(xe).componentsArchiveForm.archiveNo,"onUpdate:modelValue":l[2]||(l[2]=e=>h(xe).componentsArchiveForm.archiveNo=e),placeholder:"请输入",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),d(T,{span:24},{default:c((()=>[d(k,{label:"归档备注",prop:"readme"},{default:c((()=>[d(r,{modelValue:h(xe).componentsArchiveForm.readme,"onUpdate:modelValue":l[3]||(l[3]=e=>h(xe).componentsArchiveForm.readme=e),type:"textarea",placeholder:"请输入",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1}),d(x,null,{title:c((()=>[W])),content:c((()=>[h(xe).componentsArchiveForm.files.length>0?(n(),p("div",X,[ee,m("div",le,[(n(!0),p(u,null,v(h(xe).componentsArchiveForm.files,((e,l)=>(n(),p("div",{class:"files-item",key:l},[m("div",null,b(e.fileOriginName),1),e.type<2?(n(),p("div",ae,[d(B,{ref_for:!0,ref:"upload",class:"upload-demo",action:`${h(A)}/archive/file/upload`,limit:1,data:{useSealApplyId:h(xe).componentsArchiveForm.useSealApplyId,useSealFileTypeId:h(xe).componentsArchiveForm.fileTypeId,joinBizFileId:e.bizFileId,fileSourceType:"1"},"on-success":Oe,"show-file-list":!1},{trigger:c((()=>[te,ie])),_:2},1032,["action","data"])])):w("",!0),2==e.type?(n(),p("div",{key:1,class:F(["view-file",{special:"1"===e.fileSourceType}])},[m("div",oe,[e.isArchived?(n(),p("div",re,[se,y(b(e.archiveAttachmentFileName)+"（"+b(e.fileSize)+"） ",1)])):(n(),p("div",ne,[pe,y(" "+b(e.archiveAttachmentFileName),1)]))]),m("div",de,[e.isArchived?(n(),p("div",ce,me)):(n(),p("div",he,["1"===e.fileSourceType?(n(),f(a,{key:0,style:{"margin-right":"20px"},type:"primary",onClick:e=>function(e){P.archiveFileFinish({bizFileId:xe.componentsArchiveForm.files[e].bizFileId}).then((()=>{xe.componentsArchiveForm.files[e].isArchived=!0,xe.componentsArchiveForm.files[e].fileSourceType=null,N.value.reloadData()}))}(l)},{default:c((()=>[ue])),_:2},1032,["onClick"])):(n(),p("div",ve,fe))]))])],2)):w("",!0)])))),128))])])):w("",!0),m("div",ye,[be,m("div",we,[d(B,{ref:"upload",class:"upload-demo",action:`${h(A)}/archive/file/upload/add`,limit:1,data:Y.value,"show-file-list":!1,"on-success":Ve},{trigger:c((()=>[Ae,Fe])),_:1},8,["action","data"]),m("div",ge,[(n(!0),p(u,null,v(h(xe).componentsArchiveForm.supplemenFiles,((e,l)=>(n(),p("div",{class:"upload-file-item",key:l},[m("div",{class:"file-name",title:e.fileOriginName},b(e.fileOriginName),9,ke),m("div",Te,b((e.fileSizeByte/1024).toFixed(2)+"KB"),1),Se,De,_e,Ne])))),128))])])])])),_:1})])),_:1},8,["show","confirmText","concelText"]),D.value?(n(),f(h(g),{key:0,show:D.value,"onUpdate:show":l[5]||(l[5]=e=>D.value=e)},null,8,["show"])):w("",!0)])}}},[["__scopeId","data-v-812c00ea"]]);export{Ie as default};
