var e=Object.defineProperty,a=(a,l,t)=>(((a,l,t)=>{l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t})(a,"symbol"!=typeof l?l+"":l,t),t);import l from"./index-6cd90c04.js";import{c as t}from"./tree-6d20e0a5.js";import{c as o}from"./documentsDetails-e4b559a6.js";import{v as s,s as n,r as i,o as d,f as r,w as u,a as c,u as p,x as m,g as y,cA as f,cv as h,a9 as v,_ as T,cJ as w,h as b,k as g,c as D,m as _,t as V,ai as I,l as k,F as j,cw as x,K as B,y as C,z as P}from"./main-e75bd94c.js";import{a as F}from"./actionMoreDialog-c32f63c4.js";import{J as N}from"./JyTable-735e5f88.js";/* empty css                                                             */import"./cha-kong-c10eac4e.js";import"./JyTabs-82aef442.js";/* empty css                                                               */import"./table-d1366238.js";import"./sangedian-6ea00dcf.js";/* empty css                                                                         */import"./portion-ad7469a7.js";/* empty css                                                                */import"./yuan-hui-31c99901.js";import"./Layout-a5f6ee71.js";import"./searchForm-6ca4b4e4.js";import"./ketanchude-a94e84bc.js";import"./KDocumentTypeDialog-6b47a1ba.js";import"./pagination-10abb664.js";import"./batch-99f4afc3.js";import"./index-7c7937e4.js";class S{constructor(){a(this,"fileTypeNo",""),a(this,"fileTypeName",""),a(this,"fileTypeSn",""),a(this,"fileTypePid","-1")}}class J{constructor(){a(this,"fileTypeIds",[])}}class M{constructor(){a(this,"fileTypeId",""),a(this,"organs",[]),a(this,"roles",[]),a(this,"users",[])}}class U{constructor(){a(this,"fileTypeId",""),a(this,"applicantPreview",""),a(this,"applicantDownload","")}}const A=y("提交"),E=y("取消"),O={name:"AddFileType"},q=Object.assign(O,{props:{modelValue:{type:Boolean,default:!1},optionsTree:{type:Array,default:()=>[]},curFromData:{type:Object,default:()=>{}},fileTypePid:{type:String,default:"-1"}},emits:["update:modelValue","refresh","on-closed"],setup(e,{emit:a}){const l=e,t=s(new S),o=s(null),y={fileTypeName:[{required:!0,message:"请输入",trigger:"blur"}]},T=n({get:()=>l.modelValue,set(e){a("update:modelValue",e)}}),w=async()=>{try{await o.value.validate(),t.value.fileTypePid||(t.value.fileTypePid="0"),t.value.fileTypeId?(await f.fileTypeEdit(t.value),h("文件类型修改成功")):(await f.fileTypeAdd(t.value),h("文件类型添加成功")),T.value=!1,t.value=new S,a("refresh")}catch(e){v(e)}},b=async()=>{try{if(l.curFromData.fileTypeId){const e=await await f.getFileTypeInfo(l.curFromData.fileTypeId);t.value={...t.value,...e.data}}else t.value.fileTypePid=l.fileTypePid,(async()=>{try{const e=await f.generateBizNo();t.value.fileTypeNo=e.data||""}catch(e){v(e)}})()}catch(e){v(e)}},g=()=>{T.value=!1},D=()=>{t.value=new S,a("on-closed")};return(a,s)=>{const n=i("el-input"),f=i("el-form-item"),h=i("el-tree-select"),v=i("el-form"),_=i("el-button"),V=i("JyDialog2");return d(),r(V,{title:e.curFromData.fileTypeId?"修改文件类型":"新增文件类型",modelValue:p(T),"onUpdate:modelValue":s[4]||(s[4]=e=>m(T)?T.value=e:null),onOnOpened:b,onOnClosed:D,height:220},{footer:u((()=>[c(_,{type:"primary",onClick:w},{default:u((()=>[A])),_:1}),c(_,{onClick:g},{default:u((()=>[E])),_:1})])),default:u((()=>[c(v,{ref_key:"formRef",ref:o,model:t.value,rules:y,"label-width":"120px",class:"demo-ruleForm"},{default:u((()=>[c(f,{label:"文件类型编码"},{default:u((()=>[c(n,{modelValue:t.value.fileTypeNo,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value.fileTypeNo=e),disabled:""},null,8,["modelValue"])])),_:1}),c(f,{label:"文件类型名称",prop:"fileTypeName"},{default:u((()=>[c(n,{modelValue:t.value.fileTypeName,"onUpdate:modelValue":s[1]||(s[1]=e=>t.value.fileTypeName=e),clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),c(f,{label:"文件类型字号"},{default:u((()=>[c(n,{modelValue:t.value.fileTypeSn,"onUpdate:modelValue":s[2]||(s[2]=e=>t.value.fileTypeSn=e),clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),c(f,{label:"上级文件夹"},{default:u((()=>[c(h,{modelValue:t.value.fileTypePid,"onUpdate:modelValue":s[3]||(s[3]=e=>t.value.fileTypePid=e),data:l.optionsTree,"check-strictly":"",style:{width:"100%"},props:{children:"child",label:"fileTypeName",disabled:e=>(e.fileTypeId===l.curFromData.fileTypeId||e.fileTypePid===l.curFromData.fileTypeId)&&"-1"!==e.fileTypeId},"value-key":"fileTypeId"},null,8,["modelValue","data","props"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])}}}),R=y("提交"),Y=y("取消"),z={name:"PrivacySet"},K=Object.assign(z,{props:{modelValue:{type:Boolean,default:!1},optionsTree:{type:Array,default:()=>[]},fileTypeId:{type:String,default:""}},emits:["update:modelValue","refresh","on-closed"],setup(e,{emit:a}){const l=e,t=s(new U),o=s(null),y={fileTypeName:[{required:!0,message:"请输入",trigger:"blur"}]},T=n({get:()=>l.modelValue,set(e){a("update:modelValue",e)}}),w=async()=>{try{await f.privacySet(t.value),T.value=!1,t.value=new U,h("特殊类型隐私设置成功"),a("refresh")}catch(e){v(e)}},b=()=>{t.value.fileTypeId=l.fileTypeId,(async()=>{try{const e=await f.queryPrivacyByType(l.fileTypeId);t.value={...t.value,...e.data}}catch(e){v(e)}})()},g=()=>{T.value=!1},D=()=>{t.value=new U,a("on-closed")};return(e,a)=>{const l=i("el-switch"),s=i("el-form-item"),n=i("el-form"),f=i("el-button"),h=i("JyDialog2");return d(),r(h,{title:"特殊类型隐私配置",modelValue:p(T),"onUpdate:modelValue":a[2]||(a[2]=e=>m(T)?T.value=e:null),onOnOpened:b,onOnClosed:D,width:500,appendToBody:"",class:"privacy-set-form"},{footer:u((()=>[c(f,{type:"primary",onClick:w},{default:u((()=>[R])),_:1}),c(f,{onClick:g},{default:u((()=>[Y])),_:1})])),default:u((()=>[c(n,{ref_key:"formRef",ref:o,model:t.value,rules:y},{default:u((()=>[c(s,{label:"用印单据上传附件仅申请人能预览",prop:"applicantPreview"},{default:u((()=>[c(l,{modelValue:t.value.applicantPreview,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.applicantPreview=e),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])])),_:1}),c(s,{label:"用印单据上传附件仅申请人能预览",prop:"applicantDownload"},{default:u((()=>[c(l,{modelValue:t.value.applicantDownload,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.applicantDownload=e),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}}),L=e=>(C("data-v-9eb8dd83"),e=e(),P(),e),H={class:"fileManagement-documentType"},G={class:"title"},Q=L((()=>_("div",null,"文件类型",-1))),W={class:"title-more"},X={class:"title-more-add"},Z=L((()=>_("div",{class:"title-more-down"},null,-1))),$={class:"components-tree"},ee={class:"ap-box"},ae={name:"DocumentType"},le=T(Object.assign(ae,{setup(e){const a=s(!1),n=s(!1),m=s(new J),v=s(new w),T=s(!1),C=s(!1),P=s({}),S=s(""),U=s([]),A=s(new M),E=s([]),O=s(!1),R=s(null),Y=s(null),z=s(null),L=s([]),ae=b({componentsSearchForm:{style:{lineStyle:{width:"calc(100% / 3)"},labelStyle:{width:"100px"}},data:[{id:"keyword",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"请输入文件类型名称或编码"}},{id:"beginTime",label:"创建时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{},requestType:"array"}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:[{prop:"fileTypeNo",label:"文件类型编码",sortable:!0,show:!0,"min-width":150},{prop:"fileTypeName",label:"文件类型名称",sortable:!0,show:!0,"min-width":150},{prop:"level",label:"文件类型层级",sortable:!0,show:!0,"min-width":150},{prop:"fileSum",label:"文件数",sortable:!0,show:!0,"min-width":150},{prop:"createUser",label:"创建人",sortable:!0,show:!0,"min-width":150},{prop:"createDatetime",label:"创建时间",show:!0,sortable:!0,"min-width":180},{prop:"caozuo",label:"操作",fixed:"right",show:!0,width:350,rankDisplayData:[{name:"修改",code:1},{name:"删除",code:2},{name:"设置可见范围",code:3},{name:"特殊类型隐私配置",code:4}]}]},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"default-expand-all":!0,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"fileTypeId","current-node-key":"-1"},defaultProps:{label:"fileTypeName",children:"child",isLeaf:"haveChildren",nodeKey:"fileTypeId"},value:""},componentsDocumentsDetails:{show:!1,visible:[{label:"文件详情",name:"Details-of-Document"},{label:"操作记录",name:"operating-record"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[{name:"批量删除",code:1}]},JyElMessageBox:{show:!1,header:{data:""},content:{data:""}},showToastDialog:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""}},showDeleteFTyle:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""}}}),le=(e,a,l,t)=>{m.value.fileTypeIds=x([e],"child","fileTypeId"),R.value.reloadData()},te=()=>{(async()=>{try{C.value=!0;const e=await f.getFileTypeListPage({...m.value,...v});ae.componentsTable.data=e.data.records||[],v.value.total=e.data&&e.data.total,v.value.pages=e.data&&e.data.pages}catch(e){}C.value=!1})(),(async()=>{try{const e=await f.getTreeList({});ae.componentsTree.data=[],ae.componentsTree.data.push({fileTypeName:"文件类型",fileTypeId:"-1",child:e.data||[]}),ae.componentsTree.value="-1",R.value.reloadData()}catch(e){}})(),P.value={}},oe=async()=>{var e;try{E.value.length?(await f.batchDelete({fileTypeIds:E.value}),h("批量删除成功"),ae.showToastDialog.show=!1):(await f.fileTypeDelete(S.value),h("成功删除文件类型"),ae.JyElMessageBox.show=!1),te()}catch(a){if(a.code&&500===a.code&&(null==(e=a.data)?void 0:e.length)){ae.showToastDialog.show=!1,ae.JyElMessageBox.show=!1,ae.componentsBatch.selectionData=[],ae.showDeleteFTyle.show=!0;const e=L.value.filter((e=>a.data.includes(e.fileTypeId)));z.value={header:"删除失败",content:"以下文件类型已被使用，不允许删除，若文件类型被已启用的文件类型关联或者已发起用印申请，则认为被使用。",selectionData:e}}}},se=async e=>{try{const l=await f.queryVisibleRByFileType(e),t=l.data.roles?l.data.roles:[],o=l.data.organs?l.data.organs:[],s=l.data.users?l.data.users:[];U.value=[...o,...t,...s],n.value=!0,setTimeout((()=>{a.value=!0}),50)}catch(l){}},ne=()=>{a.value=!1,setTimeout((()=>{n.value=!1}),300)},ie=async e=>{e.forEach((a=>{"user"===a.type&&(A.value.users=e.filter((e=>"user"===e.type))),"organ"===a.type&&(A.value.organs=e.filter((e=>"organ"===e.type))),"role"===a.type&&(A.value.roles=e.filter((e=>"role"===e.type)))}));try{await f.viewRangSet(A.value);a.value=!1,h("可见范围设置成功")}catch(l){}},de=()=>{P.value={}},re=async(e,a)=>{const l=R.value.getSelectionRows();E.value=l.map((e=>e.fileTypeId)),1===e.code&&(ae.componentsBatch.selectionData=a,Y.value={header:{data:"批量删除"},content:{data:"是否删除以下文件类型？"}},ae.showToastDialog.show=!0),2===e.code&&B("待产品确认回显功能")};function ue(e,a,l,t){"1"===a.property&&(ae.componentsDocumentsDetails.show=!0)}function ce(){ae.componentsDocumentsDetails.show=!1}function pe(e,a,l,t){S.value=a.fileTypeId,1===l.code&&(T.value=!0,P.value={...P.value,...a}),2===l.code&&(ae.JyElMessageBox.header.data="提示？",ae.JyElMessageBox.content.data="您确定要删除该记录吗？",ae.JyElMessageBox.show=!0),3===l.code&&(A.value.fileTypeId=a.fileTypeId,se(a.fileTypeId)),4===l.code&&(O.value=!0)}return g((()=>{te()})),(e,s)=>{const f=i("el-button"),h=i("JyElMessageBox"),v=l;return d(),D(j,null,[_("div",H,[c(N,{url:"/fileType/page",ref_key:"table",ref:R,method:"POST",hasTree:!0,needAutoRequest:!1,componentsSearchForm:p(ae).componentsSearchForm,componentsTableHeader:p(ae).componentsTable.header,componentsBatch:p(ae).componentsBatch,queryParams:m.value,tableClick:"sealName",onCellClick:ue,onCustomClick:pe,onClickBatchButton:re,onGetResult:s[2]||(s[2]=e=>L.value=e)},{title:u((()=>[_("div",G,[Q,_("div",W,[_("div",X,[c(f,{type:"primary",onClick:s[0]||(s[0]=e=>T.value=!0)},{default:u((()=>[y("+ "+V(e.$t("t-zgj-add")),1)])),_:1})]),Z])])])),tree:u((()=>[_("div",$,[c(p(t),{ref:"tree",modelValue:p(ae).componentsTree.value,"onUpdate:modelValue":s[1]||(s[1]=e=>p(ae).componentsTree.value=e),data:p(ae).componentsTree.data,defaultAttribute:p(ae).componentsTree.defaultAttribute,defaultProps:{children:"child",label:"fileTypeName"},onNodeClick:le},null,8,["modelValue","data","defaultAttribute"])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),_("div",ee,[c(o,{show:p(ae).componentsDocumentsDetails.show,visible:p(ae).componentsDocumentsDetails.visible,onClickClose:ce},null,8,["show","visible"])]),n.value?(d(),r(p(I),{key:0,show:a.value,"onUpdate:show":ne,"onUpdate:searchSelected":ie,searchSelected:U.value,tabsShow:["user","organ","role"]},null,8,["show","searchSelected"])):k("",!0),c(h,{modelValue:p(ae).JyElMessageBox.show,"onUpdate:modelValue":s[3]||(s[3]=e=>p(ae).JyElMessageBox.show=e),show:p(ae).JyElMessageBox.show,defaultAttribute:{},onConfirmClick:oe},{header:u((()=>[y(V(p(ae).JyElMessageBox.header.data),1)])),content:u((()=>[y(V(p(ae).JyElMessageBox.content.data),1)])),_:1},8,["modelValue","show"])]),c(p(q),{modelValue:T.value,"onUpdate:modelValue":s[4]||(s[4]=e=>T.value=e),optionsTree:p(ae).componentsTree.data,onRefresh:te,curFromData:P.value,onOnClosed:de,fileTypePid:m.value.fileTypeIds[0]},null,8,["modelValue","optionsTree","curFromData","fileTypePid"]),c(p(K),{modelValue:O.value,"onUpdate:modelValue":s[5]||(s[5]=e=>O.value=e),fileTypeId:S.value},null,8,["modelValue","fileTypeId"]),c(p(F),{"onUpdate:modelValue":s[6]||(s[6]=e=>p(ae).showToastDialog.show=!1),show:p(ae).showToastDialog.show,selectionData:p(ae).componentsBatch.selectionData,showToastDialogContent:Y.value,label:"formName",onSureAction:oe,curKey:"fileTypeName"},null,8,["show","selectionData","showToastDialogContent"]),c(v,{"onUpdate:modelValue":s[7]||(s[7]=e=>p(ae).showDeleteFTyle.show=!1),show:p(ae).showDeleteFTyle.show,showToastDialogContent:z.value,label:"fileTypeName"},null,8,["show","showToastDialogContent"])],64)}}}),[["__scopeId","data-v-9eb8dd83"]]);export{le as default};
