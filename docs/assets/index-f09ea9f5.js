import{g as e,P as a,i as o,n as t,a1 as l}from"./chunk-vform-d740b35c.js";import{r as n,b as r,a9 as d,C as s,F as u,G as i,B as c,N as m,H as g,R as p,I as h,Q as v,_ as f,u as b,J as w,S as N,T as y,n as I,V as j,W as x}from"./chunk-element-plus-a77de3d2.js";import{_ as D}from"./gengduo-caozuo-730fe1cb.js";import{_ as P}from"./ketanchude-a94e84bc.js";import{J as _}from"./JyTable-d62bb35b.js";import{a as k}from"./department-66227f1b.js";import{a as z}from"./actionMoreDialog-7035c1c1.js";import{_ as T}from"./index-c506766f.js";import"./sangedian-6ea00dcf.js";import"./Layout-e90710df.js";import"./searchForm-96cc0cf8.js";import"./KDocumentTypeDialog-63de8919.js";import"./pagination-3c925a2b.js";import"./batch-6eb7c760.js";import"./index-d761d72f.js";import"./index-0b145b80.js";import"./cha-kong-c10eac4e.js";import"./index-5b654134.js";import"./yuan-hui-31c99901.js";import"./index-2f43646f.js";import"./home-back-d5b479fa.js";import"./logo-ad08cc7e.js";import"./request-util-79a78767.js";import"./main-673bace6.js";const B=[{prop:"organName",label:"部门名称","min-width":150,fixed:"left",show:!0},{prop:"organNo",label:"部门编码","min-width":150,show:!0},{prop:"organTypeName",label:"组织类型","min-width":150,show:!0},{prop:"organUserNum",label:"部门人数",sortable:"custom",align:"center",width:150,show:!0},{prop:"organLeaderName",label:"部门主管","min-width":150,show:!0},{prop:"organPName",label:"上级组织","min-width":150,show:!0},{prop:"flag",label:"状态",show:!0},{prop:"caozuo",label:"操作","min-width":250,fixed:"right",align:"center",show:!0,rankDisplayData:[{name:"t-zgj-Edit"},{name:"status"},{name:"t-zgj-Delete"}]}],C=e=>(j("data-v-36305306"),e=e(),x(),e),A={class:"title"},L=C((()=>g("div",null,"单位与部门管理",-1))),V={class:"title-more"},O={class:"title-more-add"},E={class:"title-more-down"},U=C((()=>g("img",{class:"button-icon",src:D,alt:"",srcset:""},null,-1))),F=p("导入"),S={class:"components-tree"},$=p("部门"),q=p("单位"),J={class:"select-box-contBox"},R=C((()=>g("div",{class:"ap-box-contBox-icon"},[g("img",{class:"ap-box-contBox-icon-img",src:P,alt:""})],-1))),W={class:"select-box-contBox"},H=C((()=>g("div",{class:"ap-box-contBox-icon"},[g("img",{class:"ap-box-contBox-icon-img",src:P})],-1))),M={class:"header-div"},Q=C((()=>g("img",{src:l},null,-1))),Y={class:"content-div"},G=e({setup(e){const l=n(!1),j=n([]),x=n(!1),D=n(!1),P=n(!1),C=n(null),G=n([]),K=n(["organ"]),X=n(null),Z=n("-1"),ee=n(null),ae=n(!1),oe=n(!1),te=n(null),le=n(null),ne=n(!1),re=n(null),de=n(null),se=n(null),ue=n(null),ie=n(null),ce=n([]),me=n(null),ge=r({organId:"",organNo:"",organName:"",organTypeId:"department",organPid:"",organPName:"",organLeaderId:"",organLeaderName:"",readme:""}),pe=r({organName:[{required:!0,message:"请输入部门名称",trigger:"change"}],organPName:[{required:!0,message:"请选择上级部门",trigger:"change"}]}),he=r({showOneAction:{show:!1,header:{data:""},content:{data:""}},componentsSearchForm:{data:[{id:"keyWord",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"部门名称/部门编码"}},{id:"flag",label:"状态",type:"select",inCommonUse:!0,options:[{label:"启用",value:1},{label:"停用",value:0}],defaultAttribute:{placeholder:"请选择"}}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:B},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"organId","current-node-key":"-1",accordion:!0},defaultProps:{label:"organName",children:"children",isLeaf:"haveChildren"},value:""},componentsBatch:{selectionData:[],data:[{name:"t-zgj-dept.BatchDeactivation"},{name:"t-zgj-dept.BatchEnable"},{name:"t-zgj-seal.BatchDelete"}]}});function ve(e,a,o,t){Z.value=e.organId,l.value=!0,j.value=[{value:"detail",params:e.organId},{value:"organizer",params:e.organId}]}function fe(e,a,t,l){"t-zgj-Edit"===t.name?(x.value=!0,ge.organId=a.organId,I((()=>{C.value.resetFields(),k.detail(a.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||o("accountInfo")&&o("accountInfo").userDepartName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))):"t-zgj-F_SEAL_INFO_UP"===t.name||"t-zgj-F_SEAL_INFO_DOWN"===t.name||("status"===t.name?(ue.value="启用"===a.flag?"t-zgj-Disable":"t-zgj-Enable",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示","启用"===a.flag?he.showOneAction.content.data="是否停用该部门？":he.showOneAction.content.data="是否启用该部门？"):"t-zgj-Delete"===t.name&&(ue.value="t-zgj-Delete",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门？"))}function be(){"t-zgj-Enable"===ue.value?k.batchEnable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Disable"===ue.value?k.batchDisable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Delete"===ue.value&&k.batchDelete([se.value]).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{ne.value=!1,he.showOneAction.show=!1}))}function we(e,a){re.value=e.name,"t-zgj-dept.BatchDeactivation"===e.name?de.value={header:{data:"批量停用"},content:{data:"是否批量停用这些部门？"}}:"t-zgj-dept.BatchEnable"===e.name?de.value={header:{data:"批量启用"},content:{data:"是否批量启用这些部门？"}}:"t-zgj-seal.BatchDelete"===e.name&&(de.value={header:{data:"批量删除"},content:{data:"是否批量删除这些部门？"}}),he.componentsBatch.selectionData=a,ne.value=!0}const Ne=e=>{P.value=!0,X.value=e,"organP"===e?(K.value=["organ"],G.value=ge.organPid?[{id:ge.organPid,name:ge.organPName,type:"organ"}]:[]):(K.value=["user"],G.value=ge.organLeaderId?[{id:ge.organLeaderId,name:ge.organLeaderName,type:"user"}]:[]),setTimeout((()=>{D.value=!0}),200)},ye=()=>{D.value=!1,setTimeout((()=>{P.value=!1}),200)},Ie=()=>{x.value=!0,I((()=>{ge.organPid="",ge.organId="",ge.organPName="",ge.organLeaderName="",C.value.resetFields()}))},je=n(!0),xe=()=>{C.value.validate((e=>{e&&(ge.organId?(je.value=!1,k.edit(ge).then((()=>{x.value=!1,ie.value.loaded=!1,ie.value.expand(),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))):(ie.value=me.value.getNode(ge.organPid),je.value=!1,k.add(ge).then((()=>{ie.value&&(he.componentsTree.defaultAttribute["current-node-key"]=ge.organPid,Z.value=ge.organPid,x.value=!1,ie.value.loaded=!1,ie.value.expand()),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))))}))},De=e=>{"organP"===X.value?(ge.organPid=e.length?e[0].id:"",ge.organPName=e.length?e[0].name:""):(ge.organLeaderId=e.length?e[0].id:"",ge.organLeaderName=e.length?e[0].name:"")};function Pe(e,a){if(0===e.level)ie.value=e,k.subOrganList(-1).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),ce.value=e.data,a([{organName:o("accountInfo")&&o("accountInfo").userDepartName,organId:"-1",haveChildren:!1,children:[]}])))).then((()=>{I((()=>{const e=ie.value.childNodes[0];e&&(e.expanded=!0),e&&e.loadData()}))}));else{if(1===e.level)return a(ce.value);k.subOrganList(e.data.organId).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),a(e.data))))}}function _e(e,a){ie.value=a,Z.value=e.organId,ee.value.reloadData()}function ke(e,a,o){1===o.level?oe.value=!1:oe.value=!0,ae.value=!0,le.value=a,te.value.$el.style.right=0,te.value.$el.style.top=e.layerY+10+"px",document.addEventListener("click",ze)}function ze(){ae.value=!1,document.removeEventListener("click",ze)}function Te(){x.value=!0,I((()=>{C.value.resetFields(),ge.organPid=le.value.organId,ge.organPName=le.value.organName}))}function Be(){x.value=!0,ge.organId=le.value.organId,I((()=>{C.value.resetFields(),k.detail(le.value.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||JSON.parse(localStorage.getItem("departLists")).find((e=>e.tenantId===localStorage.getItem("tenantId"))).tenantName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))}function Ce(){se.value=le.value.organId,ue.value="t-zgj-Delete",he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门"}const Ae=()=>{"t-zgj-dept.BatchDeactivation"===re.value?k.batchDisable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{ne.value=!1})):"t-zgj-dept.BatchEnable"===re.value?k.batchEnable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{ne.value=!1})):"t-zgj-seal.BatchDelete"===re.value&&k.batchDelete(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{ne.value=!1}))};return d((()=>{})),(e,o)=>{const n=s("el-button"),r=s("el-dropdown-item"),d=s("el-dropdown-menu"),I=s("el-dropdown"),k=s("el-tree"),B=s("el-card"),X=s("el-input"),le=s("el-form-item"),re=s("el-radio"),se=s("el-radio-group"),ue=s("el-form"),ie=t,ce=s("JyElMessageBox");return u(),i("div",null,[c(_,{url:"/organ/page",ref_key:"table",ref:ee,componentsSearchForm:b(he).componentsSearchForm,componentsTableHeader:b(he).componentsTable.header,componentsBatch:b(he).componentsBatch,queryParams:{organId:Z.value},statusColoum:"flag",openValue:"启用",hasTree:"",tableClick:"organName",onCellClick:ve,onCustomClick:fe,onClickBatchButton:we},{title:m((()=>[g("div",A,[L,g("div",V,[g("div",O,[c(n,{type:"primary",onClick:Ie},{default:m((()=>[p("+ "+h(e.$t("t-zgj-add")),1)])),_:1})]),g("div",E,[c(I,{"popper-class":"more-operation-dropdown"},{dropdown:m((()=>[c(d,null,{default:m((()=>[c(r,null,{default:m((()=>[F])),_:1})])),_:1})])),default:m((()=>[c(n,null,{default:m((()=>[U,g("span",null,h(e.$t("t-zgj-table.more.Operation")),1)])),_:1})])),_:1})])])])])),tree:m((()=>[g("div",S,[je.value?(u(),v(k,f({key:0,ref_key:"deptTreeRef",ref:me,data:b(he).componentsTree.data,props:b(he).componentsTree.defaultProps},b(he).componentsTree.defaultAttribute,{lazy:"",load:Pe,onCurrentChange:_e,onNodeContextmenu:ke}),null,16,["data","props"])):w("",!0),N(c(B,{class:"box-card",ref_key:"card",ref:te,"body-style":{padding:"0 10px"}},{default:m((()=>[g("div",{class:"add",onClick:Te},"添加子部门"),N(g("div",{class:"delete",onClick:Be}," 编辑部门 ",512),[[y,oe.value]]),N(g("div",{class:"edit",onClick:Ce}," 删除部门 ",512),[[y,oe.value]])])),_:1},512),[[y,ae.value]])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),c(T,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),modulesName:"unit_and_department",detailParams:j.value},null,8,["modelValue","detailParams"]),c(ie,{"onUpdate:show":o[9]||(o[9]=e=>x.value=e),show:x.value,title:b(ge).organId?e.$t("t-zgj-Edit"):e.$t("t-zgj-add"),centerBtn:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),width:900,height:400,onConfirm:xe},{default:m((()=>[c(ue,{model:b(ge),rules:b(pe),ref_key:"vFormLibraryRef",ref:C,"label-width":"80px"},{default:m((()=>[c(le,{label:"部门名称",prop:"organName"},{default:m((()=>[c(X,{modelValue:b(ge).organName,"onUpdate:modelValue":o[1]||(o[1]=e=>b(ge).organName=e),placeholder:"请输入",clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),c(le,{label:"组织类型",prop:"organTypeId"},{default:m((()=>[c(se,{modelValue:b(ge).organTypeId,"onUpdate:modelValue":o[2]||(o[2]=e=>b(ge).organTypeId=e)},{default:m((()=>[c(re,{label:"department",size:"large"},{default:m((()=>[$])),_:1}),c(re,{label:"unit",size:"large"},{default:m((()=>[q])),_:1})])),_:1},8,["modelValue"])])),_:1}),c(le,{label:"部门编码",prop:"organNo"},{default:m((()=>[c(X,{modelValue:b(ge).organNo,"onUpdate:modelValue":o[3]||(o[3]=e=>b(ge).organNo=e),placeholder:"请输入",maxlength:"64"},null,8,["modelValue"])])),_:1}),c(le,{label:"上级部门",prop:"organPName"},{default:m((()=>[g("div",J,[c(X,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:b(ge).organPName,"onUpdate:modelValue":o[4]||(o[4]=e=>b(ge).organPName=e),placeholder:"请选择",onClick:o[5]||(o[5]=e=>Ne("organP"))},null,8,["modelValue"]),R])])),_:1}),c(le,{label:"部门领导",prop:"organLeaderId"},{default:m((()=>[g("div",W,[c(X,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:b(ge).organLeaderName,"onUpdate:modelValue":o[6]||(o[6]=e=>b(ge).organLeaderName=e),placeholder:"请选择",onClick:o[7]||(o[7]=e=>Ne("leaderUser"))},null,8,["modelValue"]),H])])),_:1}),c(le,{label:"备注",prop:"readme"},{default:m((()=>[c(X,{modelValue:b(ge).readme,"onUpdate:modelValue":o[8]||(o[8]=e=>b(ge).readme=e),type:"textarea",maxlength:"512"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show","title","confirmText","concelText"]),P.value?(u(),v(b(a),{key:0,show:D.value,"onUpdate:show":ye,searchSelected:G.value,"onUpdate:searchSelected":De,tabsShow:K.value,multiple:!1,hasTopRoot:!0},null,8,["show","searchSelected","tabsShow"])):w("",!0),c(b(z),{"onUpdate:modelValue":o[10]||(o[10]=e=>ne.value=!1),show:ne.value,selectionData:b(he).componentsBatch.selectionData,showToastDialogContent:de.value,label:"organName",onSureAction:Ae},null,8,["show","selectionData","showToastDialogContent"]),c(ce,{modelValue:b(he).showOneAction.show,"onUpdate:modelValue":o[11]||(o[11]=e=>b(he).showOneAction.show=e),mode:1,showClose:!1,defaultAttribute:{},onConfirmClick:be},{header:m((()=>[g("div",M,[Q,g("span",null,h(b(he).showOneAction.header.data),1)])])),content:m((()=>[g("div",Y,h(b(he).showOneAction.content.data),1)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-36305306"]]);export{G as default};
