import{g as e}from"./chunk-vform-d740b35c.js";import{j as t,r as l,w as a,C as n,F as s,G as o,B as i,N as u,H as r,O as c,u as d,I as v,c as f,V as h,W as p}from"./chunk-element-plus-a77de3d2.js";const m=e=>(h("data-v-444f0115"),e=e(),p(),e),g={class:"vertify-box"},y={class:"vertify"},w={class:"content"},C={className:"canvasArea"},b=["width","height"],x=["width","height"],T=["className"],k=[m((()=>r("use",{href:"#btn1",class:"btn1"},null,-1))),m((()=>r("use",{href:"#btn2",class:"btn2"},null,-1)))],N={className:"sliderText"},M=[m((()=>r("div",{className:"loadingIcon"},null,-1))),m((()=>r("span",null,"加载中...",-1)))],R=m((()=>r("svg",{class:"iconpark-icon"},[r("use",{href:"#close"})],-1))),S=[m((()=>r("use",{href:"#flush"},null,-1)))],I=e({props:{title:{type:String,default:"title"},width:{type:Number,default:280},modelValue:{type:Boolean,default:!0},height:{type:Number,default:160},visible:{type:Boolean,default:()=>!0},l:{type:Number,default:42},r:{type:Number,default:9},imgUrl:{type:String,default:""},text:{type:String,default:"拖动滑块完成拼图"},onDraw:()=>{},onCustomVertify:()=>{},onBeforeRefresh:()=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["update:modelValue","on-closed","click","on-success","on-failed"],setup(e,{emit:h}){const p=e,m=t({get:()=>p.modelValue,set(e){h("update:modelValue",e)}}),I=()=>{h("on-closed")},{text:V,l:_,r:X,imgUrl:D,width:B,height:O,visible:A,onBeforeRefresh:F,onRefresh:U,onFail:Y,onSuccess:j,onCustomVertify:W,onDraw:$}=p,q=l(!0),E=l(0),G=l("sliderContainer"),H=l(V),L=l(null),P=l(null),z=l(null),J=l(!1),K=l([]),Q=l(0),Z=l(0),ee=l(0),te=l(0),le=Math.PI,ae=_+2*X+3,ne=(e,t,l,a)=>{e.beginPath(),e.moveTo(t,l),e.arc(t+_/2,l-X+2,X,.72*le,2.26*le),e.lineTo(t+_,l),e.arc(t+_+X-2,l+_/2,X,1.21*le,2.78*le),e.lineTo(t+_,l+_),e.lineTo(t,l+_),e.arc(t+X-2,l+_/2,X+.4,2.76*le,1.24*le,!0),e.lineTo(t,l),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===a?e.fill():e.clip()},se=()=>D||`https://picsum.photos/id/${fe(0,1084)}/${B}/${O}`,oe=()=>{const e=(e=>{const t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=()=>{t.setSrc(se())},t.setSrc=e=>{if(window.navigator.userAgent.indexOf("Trident")>-1){const l=new XMLHttpRequest;l.onloadend=function(e){const l=new FileReader;l.readAsDataURL(e.target.response),l.onloadend=function(e){t.src=e.target.result}},l.open("GET",e),l.responseType="blob",l.send()}else t.src=e},t.setSrc(se()),t})((()=>{q.value=!1,(e=>{const t=L.value.getContext("2d"),l=P.value.getContext("2d");ee.value=fe(ae+10,B-(ae+10)),te.value=fe(10+2*X,O-(ae+10)),ne(t,ee.value,te.value,"fill"),ne(l,ee.value,te.value,"clip"),t.drawImage(e,0,0,B,O),l.drawImage(e,0,0,B,O);const a=te.value-2*X-1,n=l.getImageData(ee.value-3,a,ae,ae);P.value.width=ae,l.putImageData(n,0,a)})(e)}));z.value=e},ie=()=>{const e=L.value.getContext("2d"),t=P.value.getContext("2d");E.value=0,G.value="sliderContainer",P.value.width=B,P.value.style.left="0px",e.clearRect(0,0,B,O),t.clearRect(0,0,B,O),F&&F(),q.value=!0,z.value.setSrc(se())},ue=()=>{ie(),"function"==typeof U&&U()},re=()=>{const e=K.value,t=e.reduce(he)/e.length,l=e.map((e=>e-t)),a=Math.sqrt(l.map(pe).reduce(he)/e.length),n=parseInt(P.value.style.left);return{spliced:Math.abs(n-ee.value)<10,verified:0!==a,left:n,destX:ee.value}},ce=function(e){Q.value=e.clientX||e.touches[0].clientX,Z.value=e.clientY||e.touches[0].clientY,J.value=!0},de=e=>{if(!J.value)return!1;e.preventDefault();const t=e.clientX||e.touches[0].clientX,l=e.clientY||e.touches[0].clientY,a=t-Q.value,n=l-Z.value;if(a<0||a+38>=B)return!1;E.value=a;const s=(B-40-20)/(B-40)*a;P.value.style.left=s+"px",G.value="sliderContainer sliderContainer_active",K.value.push(n),$&&$(s)},ve=e=>{if(!J.value)return!1;J.value=!1;if((e.clientX||e.changedTouches[0].clientX)===Q.value)return!1;G.value="sliderContainer";const{spliced:t,verified:l}=W?W(re()):re();t?l?(G.value="sliderContainer sliderContainer_success","function"==typeof j&&j(),m.value=!1,h("on-success")):(G.value="sliderContainer sliderContainer_fail",H.value="请再试一次",h("on-failed"),ie()):(G.value="sliderContainer sliderContainer_fail","function"==typeof Y&&Y(),setTimeout(ie.bind(this),1e3))},fe=(e,t)=>Math.round(Math.random()*(t-e)+e),he=(e,t)=>e+t,pe=e=>e*e,me=()=>{oe()};return a((()=>A),(()=>{A&&(z.value?ie():oe())})),(e,t)=>{const l=n("el-dialog");return s(),o("div",g,[i(l,{modelValue:d(m),"onUpdate:modelValue":t[0]||(t[0]=e=>f(m)?m.value=e:null),width:d(B),center:"","align-center":"","destroy-on-close":"",onClosed:I,onOpen:me},{default:u((()=>[r("div",y,[r("div",w,[r("div",{className:"vertifyWrap",style:c({width:d(B)+"px",margin:"0 auto",display:d(A)?"":"none"}),onMousemove:de,onMouseup:ve,onTouchmove:de,onTouchend:ve},[r("div",C,[r("canvas",{ref_key:"canvasRef",ref:L,width:d(B),height:d(O)},null,8,b),r("canvas",{ref_key:"blockRef",ref:P,className:"block",width:d(B),height:d(O),onMousedown:ce,onTouchstart:ce},null,40,x)]),r("div",{className:G.value,style:c({pointerEvents:q.value?"none":"auto"})},[r("div",{className:"sliderMask",style:c({width:E.value>0?E.value+8+"px":E.value+"px"})},[(s(),o("svg",{class:"iconpark-icon slider",style:c({left:E.value-10+"px"}),onMousedown:ce,onTouchstart:ce},k,36))],4),r("div",N,v(H.value),1)],12,T),r("div",{className:"loadingContainer",style:c({width:d(B)+"px",height:d(O)+"px",display:q.value?"":"none"})},M,4)],36),r("div",{class:"vertify-footer"},[R,r("svg",{class:"iconpark-icon",onClick:ue},S)])])])])),_:1},8,["modelValue","width"])])}}},[["__scopeId","data-v-444f0115"]]);export{I as default};
