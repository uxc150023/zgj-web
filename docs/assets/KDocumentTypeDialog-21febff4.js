import{B as e,g as l,U as t,W as a,X as i,Y as d,Z as s,k as c,I as n,$ as u,n as r,a0 as h}from"./chunk-vform-ec6574e8.js";import{e as o,at as v,a as f,aQ as p,W as m,X as g,Y as y,ap as S,u as C,a3 as w,aE as b,ai as E,ao as x,aj as k,ak as P,ah as L,am as N,ba as V,bb as M,an as O,ae as T}from"./chunk-ant-design-vue-a1de3c57.js";import{E as j}from"./chunk-element-plus-636450f3.js";const A={treeList:l=>e({method:"GET",url:"/fileType/queryList",params:l})},F={style:{height:"100%"}},B={class:"select-search"},J={class:"select-crumbs user-select"},U={class:"custom-bread"},H=["onClick"],Z={class:"item-arrow"},_={width:"6",height:"10",viewBox:"0 0 6 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},z=[(e=>(V("data-v-3e01129c"),e=e(),M(),e))((()=>y("path",{d:"M3.78132 5.00001L0.481323 1.70001L1.42399 0.757342L5.66666 5.00001L1.42399 9.24268L0.481323 8.30001L3.78132 5.00001Z",fill:"black","fill-opacity":"0.25"},null,-1)))],Q={class:"select-list user-select"},$=l({props:{apiModule:{type:String,default:""},allSelected:{type:Array,default:()=>[]},initQueryParams:{type:Object,default:()=>({})},multiple:{type:Boolean,default:!1}},emits:["update:allSelected"],setup(e,{expose:l,emit:n}){const u=e,r=o({get:()=>JSON.parse(JSON.stringify(u.allSelected)),set(e){n("update:allSelected",e)}}),h=[{id:"-1",pid:"0",name:"文件类型",haveChildren:!0,type:"fileType",idFullPathSet:"-1"}],V=v({lists:[]}),M=v({data:[]}),O=f([]),T=e=>new Promise(((l,t)=>{A.treeList(e).then((e=>{l(e)})).catch((e=>{t(e)}))})),j=f(""),$=f(!1),q=v({data:[]}),I=c((()=>{T({keyword:j.value,...u.initQueryParams}).then((e=>{const l=JSON.parse(JSON.stringify(e.data));0!==l&&(l.forEach((e=>{e.type="fileType"})),q.data=l),$.value=!0,j.value||($.value=!1),0!==r.value.length&&0!==q.data&&q.data.forEach((e=>{r.value.forEach((l=>{e.id===l.id&&(e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0)}))}))}))}),500),D=()=>{j.value?I():$.value=!1};function W(e,l,t){if(t&&"all"===t)return Y(e,l),G(e,l),void q.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}));u.multiple?(K(e,l),R(e,l),q.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}))):M.data.forEach((t=>{t.id===e.id?(t.selectedStatus=l,r.value=l?[e]:[]):t.selectedStatus=0}))}const X=(e,l)=>{W(e,l)},Y=(e,l)=>{const t=e[0].pid;!function e(a){a.forEach((a=>{if(a.id===t&&a.children.forEach((e=>{e.selectedStatus=l})),a.children&&a.children.length>0)return e(a.children)}))}(O.value)},G=(e,l)=>{if(0===l){const e=[];M.data.forEach((l=>{l.selectedStatus=0,e.push(l.id)})),r.value=r.value.filter((l=>!e.includes(l.id)))}else{M.data.forEach((e=>{e.selectedStatus=2}));const l=[];e.forEach((e=>{l.push(e.id)})),r.value=r.value.filter((e=>!l.includes(e.id))).concat(e)}},K=(e,l)=>{!function t(a){a.forEach((a=>{if(a.id===e.id&&(a.selectedStatus=l),a.children&&a.children.length>0)return t(a.children)}))}(O.value)},R=(e,l)=>{if(0===l){let l=function(a){a.forEach((a=>{if(a.id===e.id&&e.haveChildren&&(a.includeChild="0"),a.id===e.id&&"1"===t){let e=function(l){l.forEach((l=>{if(l.selectedStatus=0,l.disabled=!1,l.children&&l.children.length>0)return e(l.children)}))};a.children&&e(a.children)}if(a.children&&a.children.length>0)return l(a.children)}))};M.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0)})),r.value=r.value.filter((l=>l.id!==e.id));const{includeChild:t}=r.value.find((l=>l.id===e.id));l(O.value),$.value&&q.data.forEach((l=>{!l.idFullPathSet.includes(e.id)||"1"!==e.includeChild&&e.includeChild||l.id===e.id||(l.disabled=!1,l.selectedStatus=0)}))}else{const l=JSON.parse(JSON.stringify(r.value));$.value&&q.data.forEach((t=>{t.id===e.id&&(t.id===e.id&&e.haveChildren&&(t.includeChild="0"),l.splice(r.value.length,0,t))})),M.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=2,$.value||l.splice(r.value.length,0,t))})),r.value=l}$.value&&q.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}))},ee=(e,l)=>{const t=[];if(!e)return[];if(0===e.length)return t.push({curmbsName:"文件类型",id:"-1"}),t;const a=function(e,l){for(let i=0;i<e.length;i++){const d=e[i];if(t.push({curmbsName:d.name,id:d.id}),d.id===l)return t;if(d.children){const e=a(d.children,l);if(e)return e}t.pop()}};return a(e,l),t},le=f([]),te=e=>{const l=f([]);if(function t(a){a.forEach((a=>{if(a.id===e.id&&(l.value=a.children),a.children&&a.children.length>0)return t(a.children)}))}(O.value),l.value&&l.value.length>0){M.data=ae(l.value,r.value);const t=ee(O.value,e.id);return void(le.value=t)}T({...u.initQueryParams,parentId:e.id}).then((l=>{const t=l.data;if(t.forEach((e=>{e.selectedStatus=0,e.includeChild="string"!=typeof e.includeChild?"0":e.includeChild,e.type="fileType",e.disabled=!!e.disabled})),M.data=ae(t,r.value),"-1"===e.id)return V.lists=t.concat(h),void(O.value=d(V.lists,"id","pid"));O.value=d(function(e,l="id"){if(!Array.isArray(e))return;return e.reduce(((e,t)=>e.some((e=>e[l]===t[l]))?e:[...e,t]),[])}([...s(O.value),...M.data]),"id","pid")}));const t=ee(O.value,e.id);le.value=t};function ae(e,l){return e.forEach((e=>{0===l.length?e.selectedStatus=0:l.forEach((l=>{e.id===l.id&&(e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0)}))})),e}const ie=(e,l)=>{e.forEach((e=>{if(e.id===l.id&&(e.selectedStatus=0,e.disabled=!1,e.includeChild="0"),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&(e.selectedStatus=0,e.disabled=!1),e.children&&e.children.length>0)return ie(e.children,l)}))},de=e=>{e.forEach((e=>{if(e.selectedStatus=0,e.disabled=!1,e.children&&e.children.length>0)return de(e.children)}))},se=(e,l)=>{if(!l.haveChildren)return void(r.value=r.value.filter((e=>e.id!==l.id)));const t=f([]);JSON.parse(JSON.stringify(r.value)).forEach((e=>{e.idFullPathSet.includes(l.id)&&t.value.push(e.id)})),r.value=r.value.filter((e=>!t.value.includes(e.id)))},ce=(e,l)=>{Array.isArray(e)&&0!==e.length&&e.forEach((e=>{if(e.selectedStatus=l?2:0,e.disabled=l,e.children&&e.children.length>0)return ce(e.children,l)}))},ne=(e,l)=>{if(!l.haveChildren)return!1;const t=f([]);JSON.parse(JSON.stringify(r.value)).forEach((e=>{e.idFullPathSet.includes(l.id)&&e.id!==l.id&&t.value.push(e.id)})),r.value=r.value.filter((e=>!t.value.includes(e.id)))};return l({concelSelected:e=>{se(!1,e),ie(O.value,e),M.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0,l.disabled=!1),l.idFullPathSet.includes(e.id)&&"1"===e.includeChild&&(l.selectedStatus=0,l.disabled=!1)})),q.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0,l.disabled=!1),l.idFullPathSet.includes(e.id)&&"1"===e.includeChild&&(l.selectedStatus=0,l.disabled=!1)}))},clearSelected:()=>{r.value=[],de(M.data),de(q.data),de(O.value)},changeSwitch:(e,l)=>{ne(e,l),function l(t,a){Array.isArray(t)&&0!==t.length&&t.forEach((t=>{if(t.id===a&&ce(t.children,e),t.children&&t.children.length>0)return l(t.children,a)}))}(O.value,l.id);const t=M.data[0].pid;!function e(l,t){Array.isArray(l)&&0!==l.length&&l.forEach((l=>{if(l.id===t&&(M.data=l.children),l.children&&l.children.length>0)return e(l.children,t)}))}(O.value,t),$.value&&q.data.forEach((e=>{e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0,e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"0"===l.includeChild&&e.id!==l.id&&(e.disabled=!1,e.selectedStatus=0)}))},searchSelected:X}),(e,l)=>{const d=p("el-input"),s=p("el-tooltip");return m(),g("div",F,[y("div",B,[S(d,{modelValue:j.value,"onUpdate:modelValue":l[0]||(l[0]=e=>j.value=e),placeholder:"搜索文件类型","prefix-icon":C(t),size:"large",clearable:"",onInput:D},null,8,["modelValue","prefix-icon"])]),y("div",J,[y("div",U,[(m(!0),g(w,null,b(le.value,((e,l)=>(m(),g("div",{class:"bread-item",key:l},[S(s,{content:e.curmbsName,placement:"bottom","show-after":200},{default:E((()=>[y("div",{class:"item-text",onClick:l=>(e=>{!function l(t,a){for(let i=0;i<=t.length-1;i++){if(t[i].id===e)return void(M.data=t[i].children);if(t[i].children&&t[i].children.length>0)return l(t[i].children)}}(O.value);const l=ee(O.value,e);le.value=l})(e.id)},x(e.curmbsName),9,H)])),_:2},1032,["content"]),y("div",Z,[k((m(),g("svg",_,z,512)),[[P,l!==le.value.length-1]])])])))),128))])]),y("div",Q,[k(S(a,{lists:C(M).data,"onUpdate:lists":l[1]||(l[1]=e=>C(M).data=e),onOpen:te,onEmitsDemo:W,rootNode:h,tabActive:"fileType",multiple:u.multiple},null,8,["lists","multiple"]),[[P,!$.value]]),$.value?(m(),L(i,{key:0,lists:C(q).data,"onUpdate:lists":l[2]||(l[2]=e=>C(q).data=e),onOpen:te,onSearchSelected:X,tabActive:"fileType"},null,8,["lists"])):N("",!0)])])}}},[["__scopeId","data-v-3e01129c"]]),q=e=>(V("data-v-13e08b3e"),e=e(),M(),e),I={class:"selection-content"},D={class:"selection-left user-select"},W={key:0,style:{height:"100%"}},X={style:{display:"flex","flex-direction":"column",flex:"1"}},Y={class:"select-right-column c-p"},G={class:"clear-n"},K={key:0},R={class:"null-img"},ee=[q((()=>y("img",{src:h},null,-1)))],le={class:"select-right-label"},te=q((()=>y("div",{style:{"margin-right":"10px"}},[y("svg",{width:"12",height:"19",viewBox:"0 0 10 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[y("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1 0C0.447715 0 0 0.447715 0 1V10C0 10.5523 0.447715 11 1 11H9C9.55228 11 10 10.5523 10 10V3.38462L8.33333 1.69231L6.66667 0H1ZM4.16667 2.53846H1.66667V3.38462H4.16667V2.53846ZM1.66667 5.07692H8.33333V5.92308H1.66667V5.07692ZM8.33333 7.61539H1.66667V8.46154H8.33333V7.61539Z",fill:"black","fill-opacity":"0.25"})])],-1))),ae={style:{display:"flex",height:"25px"}},ie=["onClick"],de=[q((()=>y("svg",{width:"16",height:"16",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[y("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0.4375 7C0.4375 3.4375 3.4375 0.4375 7 0.4375C10.5625 0.4375 13.5625 3.4375 13.5625 7C13.5625 10.5625 10.5625 13.5625 7 13.5625C3.4375 13.5625 0.4375 10.5625 0.4375 7ZM9.8125 9.71875C10.0938 9.53125 10.0938 9.15625 9.8125 8.875L7.9375 7L9.90625 5.03125C10.1875 4.75 10.1875 4.375 9.90625 4.09375C9.625 3.8125 9.25 3.8125 8.96875 4.09375L7 6.0625L5.125 4.1875C4.9375 3.90625 4.5625 3.90625 4.28125 4.1875C4 4.46875 4 4.84375 4.28125 5.03125L6.15625 6.90625L4.1875 8.875C3.90625 9.0625 3.90625 9.53125 4.1875 9.8125C4.46875 10.0938 4.84375 10.0938 5.125 9.8125L7.09375 7.84375L8.96875 9.71875C9.15625 10 9.53125 10 9.8125 9.71875Z",fill:"black","fill-opacity":"0.25"})],-1)))],se=l({props:{show:{type:Boolean,default:!1},apiModule:{type:String,default:""},queryParams:{type:Object,default:()=>({})},editDeploy:{type:Boolean,default:!1},searchSelected:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0}},emits:["update:show","update:searchSelected"],setup(e,{emit:l}){const t=e,a=f({width:"calc(100%)",height:"calc(100% - 40px)"}),i=f("");i.value=n.global.t("t-zgj-process.SelectUseType");const d=f(t.searchSelected||[]),s=f(!1),c=(e,l)=>new Promise(((a,i)=>{u[t.apiModule][l](e).then((e=>{a(e)})).catch((e=>{i(e)}))}));if(t.editDeploy){const e=u[t.apiModule].key;c(t.queryParams[e],"selected").then((e=>{s.value=!0}))}else s.value=!0;t.searchSelected.length>0&&(d.value=t.searchSelected.filter((e=>"fileType"===e.type)));const h=f(null),o=()=>{h.value.clearSelected()},v=()=>{l("update:show",!1)},C=f([]),V=()=>{const e={...t.queryParams,organs:d.value};t.editDeploy?c(e,"save").then((e=>{j.success(e.msg||"操作成功"),l("update:show",!1)})).catch((()=>{})):(C.value=C.value.concat(d.value),l("update:searchSelected",C.value),l("update:show",!1),C.value=[])};return(l,c)=>{const n=p("el-switch"),u=p("el-scrollbar"),f=r;return m(),L(f,{"onUpdate:show":t.show,show:t.show,title:i.value,onClose:v,onConfirm:V,confirmText:l.$t("t-zgj-select.confirm"),concelText:l.$t("t-zgj-operation.cancel"),centerBtn:"",height:574,width:900,appendToBody:"",customStyle:a.value},{default:E((()=>[y("div",I,[y("div",D,[s.value?(m(),g("div",W,[S($,{ref_key:"kdocument",ref:h,initQueryParams:t.queryParams,apiModule:e.apiModule,allSelected:d.value,"onUpdate:allSelected":c[0]||(c[0]=e=>d.value=e),multiple:t.multiple},null,8,["initQueryParams","apiModule","allSelected","multiple"])])):N("",!0)]),y("div",X,[y("div",Y,[y("div",G,[O(x(l.$t("t-zgj-selectPerson.Selected"))+"： ",1),0!==d.value.length?(m(),g("span",K,x(d.value.length)+" "+x(l.$t("t-zgj-cg-menu-wenjian-leixing")),1)):N("",!0)]),k(y("div",{class:"select-close clear-t",onClick:o},x(l.$t("t-zgj-dialog-clear")),513),[[P,0!==d.value.length]])]),S(u,{class:"selection-right user-select",always:""},{default:E((()=>[k(y("div",R,ee,512),[[P,0===d.value.length]]),(m(!0),g(w,null,b(d.value,((e,l)=>(m(),g("div",{class:"select-right-column p",key:l},[y("div",le,[te,y("div",{class:"select-label",style:T(e.haveChildren&&t.multiple?"":"width: 340px")},x(e.name),5)]),y("div",ae,[e.haveChildren&&t.multiple?(m(),L(n,{key:0,modelValue:e.includeChild,"onUpdate:modelValue":l=>e.includeChild=l,"active-value":"1","inactive-value":"0",style:{"margin-right":"12px"},onChange:l=>{return t=l,a=e,void(h.value&&h.value.changeSwitch(t,a));var t,a}},null,8,["modelValue","onUpdate:modelValue","onChange"])):N("",!0),y("div",{class:"select-close",onClick:l=>{return t=e,void h.value.concelSelected(t);var t}},de,8,ie)])])))),128))])),_:1})])])])),_:1},8,["onUpdate:show","show","title","confirmText","concelText","customStyle"])}}},[["__scopeId","data-v-13e08b3e"]]);export{se as K};
