import{r as e,b as a,a9 as l,C as s,F as t,G as i,H as d,I as r,u as o,P as n,U as u,Q as c,N as p,B as m,S as v,R as f,J as h,a2 as g,E as b,n as _,T as y,V as k,W as w}from"./chunk-element-plus-a77de3d2.js";import{_ as x}from"./back-bdc75944.js";import{g as I,p as V,D as F,t as L,E as N,e as C,F as E}from"./chunk-vform-d740b35c.js";import{V as U}from"./VerificationBtn-572db23f.js";import{a as M}from"./navbar-85662916.js";const j=e=>(k("data-v-85dcc1bb"),e=e(),w(),e),T={class:"personall-container"},G={key:0,class:"head"},q=j((()=>d("span",{class:"title"},"个人中心",-1))),z={class:"cont"},Z={class:"info"},S={class:"user"},B={class:"user-msg"},D={class:"user-name"},P={class:"user-phone"},A={class:"phone-item"},H=j((()=>d("div",{class:"label"},"手机号:",-1))),O={class:"number"},J=j((()=>d("div",{class:"right-line"},null,-1))),R={class:"phone-item"},$=j((()=>d("div",{class:"label"},"邮箱:",-1))),K={class:"number"},Q=g('<div class="back-img" data-v-85dcc1bb><svg width="296" height="120" viewBox="0 0 296 120" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-85dcc1bb><mask id="mask0_2802_81596" style="mask-type:alpha;" maskUnits="userSpaceOnUse" x="0" y="0" width="296" height="120" data-v-85dcc1bb><rect width="296" height="120" rx="2" fill="#F1F4F8" data-v-85dcc1bb></rect></mask><g mask="url(#mask0_2802_81596)" data-v-85dcc1bb><path d="M148.393 -31.4769L295.998 35.3846L145.608 104.272L-1.99775 37.4108L148.393 -31.4769Z" fill="url(#paint0_linear_2802_81596)" data-v-85dcc1bb></path><path d="M-2 37.4111L145.607 104.274V265.354H-2V37.4111Z" fill="url(#paint1_linear_2802_81596)" data-v-85dcc1bb></path><path d="M296 35.3877L145.607 104.277V265.356H293.215L296 35.3877Z" fill="#EDEDED" data-v-85dcc1bb></path></g><defs data-v-85dcc1bb><linearGradient id="paint0_linear_2802_81596" x1="147" y1="99.7167" x2="147" y2="-29.9573" gradientUnits="userSpaceOnUse" data-v-85dcc1bb><stop stop-color="white" data-v-85dcc1bb></stop><stop offset="0.702553" stop-color="white" stop-opacity="0" data-v-85dcc1bb></stop></linearGradient><linearGradient id="paint1_linear_2802_81596" x1="145.607" y1="151.889" x2="-41.6869" y2="151.889" gradientUnits="userSpaceOnUse" data-v-85dcc1bb><stop stop-color="#F0F0F0" data-v-85dcc1bb></stop><stop offset="0.80732" stop-color="#EEEEEE" stop-opacity="0" data-v-85dcc1bb></stop></linearGradient></defs></svg></div>',1),W={class:"cont-box"},X={class:"label"},Y={class:"column"},ee=j((()=>d("div",{class:"label"},"角色 :",-1))),ae={key:0},le=j((()=>d("div",{class:"label"},"职位 :",-1))),se={class:"column"},te=j((()=>d("div",{class:"label"},"工号 :",-1))),ie={class:"column"},de=j((()=>d("div",{class:"label"},"人脸图片 :",-1))),re={class:"column"},oe=j((()=>d("div",null,null,-1))),ne=j((()=>d("div",{class:"tips"},[d("div",null,"提示"),d("div",null,"1:支持上传JPG/JPEG/PNG格式的人脸图片，大小不超过5M"),d("div",null,"2:请尽量保证人脸图形完整清晰，没有遮挡")],-1))),ue=j((()=>d("div",{class:"from-label"},"已绑定手机号",-1))),ce=j((()=>d("div",{class:"from-label"},"新手机号",-1))),pe=j((()=>d("div",{class:"from-label"},"验证码",-1))),me=f(" 提交 "),ve=f("取消"),fe=j((()=>d("div",{class:"from-label"},"已绑定邮箱",-1))),he=j((()=>d("div",{class:"from-label"},"新邮箱",-1))),ge=f(" 提交 "),be=f("取消"),_e=I({setup(g){const k=e(null),w=e({"zgj-token":V().token}),I=a({phone:"",code:""}),j=a({email:""}),_e=e(null),ye=e(null),ke=(e,a)=>{Ge.userFaceImage=a.url},we=(e,a,l)=>{N(e)},xe=e=>"image/jpeg"!==e.type&&"image/png"!==e.type&&"image/jpg"!==e.type?(b.error("请上传格式为jpg、jpeg、png的人脸图片"),!1):!(e.size/1024/1024>5)||(b.error("人脸图片最多支持5MB"),!1),Ie=()=>{C.go(-1)},Ve=e(!1),Fe=e(!1),Le=()=>{Fe.value=!0,_((()=>{ye.value.resetFields(),j.email=""}))},Ne=e=>{Fe.value=!1},Ce=()=>{ye.value.validate((e=>{if(!e)return!1;M.changeEmail(j.email).then((e=>{Fe.value=!1,b.success("更改邮箱成功!"),ze()}))}))},Ee=()=>{Ve.value=!0,_((()=>{_e.value.resetFields(),I.phone="",I.code=""}))},Ue=e=>{Ve.value=!1},Me=()=>{_e.value.validate((e=>{if(!e)return!1;M.changeMobile({phone:I.phone,code:I.code}).then((e=>{Ve.value=!1,b.success("更改手机号成功!"),ze()}))}))},je={width:"120px",height:"32px",fontSize:"14px"},Te=e(!1),Ge=a({userId:"",userName:"",userTel:"",userMail:"",userTitle:"",userNo:"",userFaceImage:"",organInfoList:[],roleInfoList:[]}),qe=()=>{_e.value.validateField("phone",(async e=>{e&&M.sendChangeMobileVerificationCode({phone:I.phone,type:"LOGIN"}).then((e=>{k.value.countDown()})).catch((e=>{}))}))},ze=()=>{M.getUserInfo().then((e=>{Ge.userId=e.data.userId,Ge.userName=e.data.userName,Ge.userTel=e.data.userTel,Ge.userMail=e.data.userMail,Ge.userTitle=e.data.userTitle,Ge.userNo=e.data.userNo,Ge.userFaceImage=e.data.userFaceImage?E+e.data.userFaceImage:"",Ge.organInfoList=e.data.organInfoList,Ge.roleInfoList=e.data.roleInfoList,Te.value=!0})).catch((e=>{Te.value=!0}))},Ze=()=>{},Se=()=>{};return l((()=>{ze()})),(e,a)=>{const l=s("el-col"),g=s("el-row"),b=s("el-image"),_=s("el-icon"),V=s("el-upload"),N=s("el-form-item"),C=s("el-input"),E=s("el-form"),M=s("el-button");return t(),i("div",T,[Te.value?(t(),i("div",G,[d("img",{class:"img",src:x,alt:"",onClick:Ie}),q,d("div",z,[d("div",Z,[d("div",S,r(o(Ge).userName&&o(Ge).userName.substr(1)),1),d("div",B,[d("div",D,r(o(Ge).userName),1),d("div",P,[d("div",A,[H,d("div",O,r(o(Ge).userTel||"-"),1),d("div",{class:"change",onClick:Ee},"更换")]),J,d("div",R,[$,d("div",K,r(o(Ge).userMail||"-"),1),d("div",{class:"change",onClick:Le},"更换")])])]),Q]),d("div",W,[(t(!0),i(n,null,u(o(Ge).organInfoList,((e,a)=>(t(),c(g,{class:"row",key:a},{default:p((()=>[m(l,{span:2,style:{"min-width":"100px"}},{default:p((()=>[v(d("div",X,"所属部门 :",512),[[y,0===a]])])),_:2},1024),m(l,{span:16},{default:p((()=>[d("div",Y,r(e.organName),1)])),_:2},1024)])),_:2},1024)))),128)),m(g,{class:"row"},{default:p((()=>[m(l,{span:2,style:{"min-width":"100px"}},{default:p((()=>[ee])),_:1}),m(l,{span:16},{default:p((()=>[(t(!0),i(n,null,u(o(Ge).roleInfoList,((e,a)=>(t(),i("span",{class:"column",key:a},[f(r(e.roleName)+" ",1),a!==o(Ge).roleInfoList.length-1?(t(),i("span",ae," 、 ")):h("",!0)])))),128))])),_:1})])),_:1}),m(g,{class:"row"},{default:p((()=>[m(l,{span:2,style:{"min-width":"100px"}},{default:p((()=>[le])),_:1}),m(l,{span:16},{default:p((()=>[d("div",se,r(o(Ge).userTitle),1)])),_:1})])),_:1}),m(g,{class:"row"},{default:p((()=>[m(l,{span:2,style:{"min-width":"100px"}},{default:p((()=>[te])),_:1}),m(l,{span:16},{default:p((()=>[d("div",ie,r(o(Ge).userNo),1)])),_:1})])),_:1}),m(g,{class:"row"},{default:p((()=>[m(l,{span:2,style:{"min-width":"100px"}},{default:p((()=>[de])),_:1}),m(l,{span:16},{default:p((()=>[d("div",re,[m(V,{action:"/api/user/editUserCenterFace",headers:w.value,"show-file-list":!1,"list-type":"picture-card","on-success":ke,"on-error":we,"before-upload":xe,"on-preview":Se,"on-remove":Ze},{default:p((()=>[o(Ge).userFaceImage?(t(),c(b,{key:0,src:o(Ge).userFaceImage,style:{padding:"6px"}},null,8,["src"])):(t(),c(_,{key:1},{default:p((()=>[m(o(F))])),_:1}))])),_:1},8,["headers"])])])),_:1})])),_:1}),m(g,null,{default:p((()=>[m(l,{span:2,style:{"min-width":"80px"}},{default:p((()=>[oe])),_:1}),m(l,{span:16},{default:p((()=>[ne])),_:1})])),_:1})])]),m(L,{title:"更换手机号",modelValue:Ve.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Ve.value=e),width:600,height:220},{footer:p((()=>[m(M,{type:"primary",onClick:Me},{default:p((()=>[me])),_:1}),m(M,{onClick:Ue},{default:p((()=>[ve])),_:1})])),default:p((()=>[m(E,{"label-position":"left",ref_key:"loginformRef",ref:_e,"label-width":"100px",model:o(I),"hide-required-asterisk":""},{default:p((()=>[m(N,null,{label:p((()=>[ue])),default:p((()=>[d("div",null,r(o(Ge).userTel),1)])),_:1}),m(N,{prop:"phone",required:"",rules:[{required:!0,message:"请输入正确的手机号",pattern:/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/,trigger:"change"}]},{label:p((()=>[ce])),default:p((()=>[m(C,{modelValue:o(I).phone,"onUpdate:modelValue":a[0]||(a[0]=e=>o(I).phone=e),placeholder:"请输入",style:{width:"210px"},maxlength:"11",oninput:"value=value.replace(/^\\.+|[^\\d.]/g,'')"},null,8,["modelValue"])])),_:1},8,["rules"]),m(N,{class:"clearfix",label:"验证码",prop:"code",required:"",rules:[{required:!0,message:"验证码是6位数字",trigger:"change",pattern:/^\d{6}$/}]},{label:p((()=>[pe])),default:p((()=>[m(C,{modelValue:o(I).code,"onUpdate:modelValue":a[1]||(a[1]=e=>o(I).code=e),placeholder:"请输入验证码",style:{width:"210px"},maxlength:"6",oninput:"value=value.replace(/^\\.+|[^\\d.]/g,'')"},null,8,["modelValue"]),m(U,{customStyle:je,customClick:!0,onCustomClickFn:qe,ref_key:"verificationBtn",ref:k},null,512)])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),m(L,{title:"更换邮箱",modelValue:Fe.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Fe.value=e),width:600,height:100},{footer:p((()=>[m(M,{type:"primary",onClick:Ce},{default:p((()=>[ge])),_:1}),m(M,{onClick:Ne},{default:p((()=>[be])),_:1})])),default:p((()=>[m(E,{"label-position":"left",ref_key:"loginEmailformRef",ref:ye,"label-width":"100px",model:o(j),"hide-required-asterisk":""},{default:p((()=>[m(N,null,{label:p((()=>[fe])),default:p((()=>[d("div",null,r(o(Ge).userMail||"暂未绑定邮箱"),1)])),_:1}),m(N,{prop:"email",required:"",rules:[{required:!0,message:"邮箱格式不正确",pattern:/^[a-z0-9A-Z]+[-|a-z0-9A-Z._]+@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\.)+[a-z]{2,}$/,trigger:"change"}]},{label:p((()=>[he])),default:p((()=>[m(C,{modelValue:o(j).email,"onUpdate:modelValue":a[3]||(a[3]=e=>o(j).email=e),placeholder:"请输入",style:{width:"210px"}},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["model"])])),_:1},8,["modelValue"])])):h("",!0)])}}},[["__scopeId","data-v-85dcc1bb"]]);export{_e as default};
