import{_ as e,I as a,C as l,v as t,h as s,j as i,k as n,r as o,o as c,c as r,a as d,w as u,m,u as f,P as p,Q as v,f as g,l as y,F as I,e as h,q as P,t as w,g as b,b4 as x,Y as D,aa as k,cz as _,cB as N,y as S,z as V,aW as M}from"./main-5d732c2e.js";import T from"./index-01980554.js";import j from"./index-bf861a3a.js";import{_ as J}from"./back-27ff22b1.js";import{_ as O}from"./step_next-d350bda7.js";import{c as q}from"./Layout-db7f64fa.js";import{S as C}from"./JyStep-25dc7a07.js";import{_ as L}from"./index-60e1d355.js";import"./index-b9b96043.js";import"./home-back-426c97de.js";import"./logo-00c7cf54.js";import"./request-util-ecea08f4.js";const F=e=>(S("data-v-5dd70f9f"),e=e(),V(),e),U={class:"Seal-application-fill-form"},z={class:"breadcrumb"},A=b(" 用印申请 "),Q=b(" 新建用印申请 "),B=b(" 新建用印申请 "),Y=F((()=>m("div",null,null,-1))),E={class:"custom-buzhou"},H={class:"custom"},W={key:1},G={class:"PrintingProcess"},K={class:"PrintingProcess-content"},R={class:"PrintingProcess-content-list-cont"},X={class:"PrintingProcess-content-list-cont-title"},Z=F((()=>m("img",{class:"PrintingProcess-content-list-cont-title-img",src:"/assets/calendar-67a958ae.svg",alt:""},null,-1))),$={class:"PrintingProcess-content-list-cont-title-span"},ee={class:"PrintingProcess-content-list-cont-list-name"},ae=F((()=>m("div",{class:"PrintingProcess-content-list-cont-list-icon"},[m("img",{class:"PrintingProcess-content-list-cont-list-icon-img",src:"/assets/tips-e93e6fe1.svg",alt:""})],-1))),le={class:"PrintingProcess-content-list-iocn"},te={key:0,class:"PrintingProcess-content-list-iocn-img",src:O,alt:""},se={key:0,class:"fixed"},ie={class:"ap-fixed"},ne=b("下一步"),oe=F((()=>m("span",{class:"ap-fixed-save-text"}," 保存模板 ",-1))),ce=F((()=>m("div",{style:{width:"300px"}}," 模板可用于提高重复发起同种类型用印申请的填写效率，一种文件类型仅允许保存一个模板，保存后可在申请页面直接引用 ",-1))),re=F((()=>m("i",{class:"ap-fixed-save-icon"},[m("svg",{class:"iconpark-icon"},[m("use",{href:"#icon4"})])],-1))),de={key:1,class:"fixed"},ue={class:"ap-fixed"},me=b("提交 "),fe=b("上一步"),pe=b(" 若当前文件类型已有模版则会覆盖，若当前文件类型没有模板则会创建，请问确定要保存吗？ "),ve=e({setup(e){const b=a(),S=l(),V=t(null),O=t(null),F=t(null),ve=t(null),ge=t(S.query.formVersionId),ye=t(null),Ie=t(!1),he=s({cache:{flowList:[{name:"填写表单信息",active:!0},{name:"确认审批流程",active:!1},{name:"完成",active:!1}],formData:{},optionData:{},SealformData:{},SealoptionData:{},PrintingProcess:{list:[{title:"盖前",list:[{name:"说明详情后续补上"}]},{title:"实时视频盖章",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖中",list:[{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"},{name:"说明详情后续补上"}]},{title:"盖后",list:[{name:"说明详情后续补上"}]},{title:"归档",list:[{name:"说明详情后续补上"}]}]}}}),Pe=t(null),we=t("one"),be=t(null),xe=t([]),De=t(null),ke=t(!1),_e=t(null),Ne=t({}),Se=t(null),Ve=t({padding:"24px 0 24px 24px"}),Me=()=>{x.templateAdd({formVersionId:ge.value,templateName:_e.value.applyName,fileTypeId:_e.value.fileTypeId,templateValue:JSON.stringify(_e.value)}).then((e=>{D.success("保存模板成功"),ke.value=!1})).catch((()=>{ke.value=!1}))},Te=()=>{ke.value=!1};function je(){b.go(-1)}function Je(){Pe.value.getFormData().then((e=>{he.cache.formData=e;const a=he.cache.flowList;a[0].active=!1,a[1].active=!0,he.cache.flowList=JSON.parse(JSON.stringify(a)),we.value="two",x.flowList({formMessageId:S.query.formMessageId,fileTypeId:e.fileTypeId}).then((e=>{e.data&&e.data.length&&(xe.value=e.data,De.value=e.data[0].flowMessageId,ye.value=e.data[0].flowVersionId,Ce(e.data[0].modelId,e.data[0].definitionId))}))}))}const Oe=async()=>{_e.value=null;const e=await Pe.value.getFormData(!1);e.fileTypeId||e.applyName?(_e.value=e,ke.value=!0):D.warning("单据名称和文件类型必填，否则不允许保存模板")};function qe(){const e=xe.value.find((e=>e.flowMessageId===De.value));ye.value=e.flowVersionId,Ce(e.modelId,e.definitionId)}function Ce(e,a){V.value={modelId:e,definitionId:a},x.flowDetail({...V.value,edit:!0}).then((async e=>{Se.value=null,k((()=>{Se.value=e.data.data,k((()=>{Ne.value={height:document.getElementById("flow-designer-box").clientHeight+"px",overflow:"hidden"}}))}))}))}function Le(){const e=he.cache.flowList;e[0].active=!0,e[1].active=!1,he.cache.flowList=JSON.parse(JSON.stringify(e)),we.value="one"}function Fe(){if(!De.value)return void D.warning("请选择审批流程");const e=M;let a={},l={};for(const s in he.cache.formData){e.indexOf(s)>-1?a={...a,[s]:he.cache.formData[s]}:l={...l,[s]:he.cache.formData[s]}}const t={modelId:V.value.modelId,definitionId:V.value.definitionId,instanceName:he.cache.formData.applyName,suggest:null,formData:{...he.cache.formData,formVersionId:ge.value,flowVersionId:ye.value,formMessageId:S.query.formMessageId,flowMessageId:De.value},variable:{subType:O.value,instanceType:F.value}};Ie.value=!0,x.submit(t).then((e=>{x.add({formMessageId:S.query.formMessageId,formVersionId:ge.value,flowVersionId:ye.value,applyTypeId:O.value,sealUseTypeId:ve.value,flowMessageId:De.value,gunsSysId:e.data.data.instanceId,customApplyField:"{}"===JSON.stringify(l)?null:l,...a}).then((()=>{b.replace({path:"/frontDesk/printControlManage/useSealManage/sealApplication/accomplish",query:{applyNo:he.cache.formData.applyNo}})})).finally((()=>{Ie.value=!1}))})).finally((()=>{Ie.value=!1}))}return i((()=>{S.query.useId?x.formQuery({formMessageId:S.query.formMessageId}).then((e=>{O.value=e.data.applyTypeId,F.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),x.templateView(S.query.useId).then((e=>{ge.value=e.data.formVersionId,Pe.value.setFormData(JSON.parse(e.data.templateValue)),k((()=>{Pe.value.setFieldValue("applyNo",_())}))}))})):x.formQuery({formMessageId:S.query.formMessageId}).then((e=>{O.value=e.data.applyTypeId,F.value=e.data.applyTypePid,ve.value=e.data.sealUseTypeId,be.value=JSON.parse(e.data.formInfo),k((()=>{Pe.value.setFieldValue("applyNo",_())}))}))})),n((()=>{})),(e,a)=>{const l=o("el-breadcrumb-item"),t=o("el-breadcrumb"),s=j,i=o("el-option"),n=o("el-select"),b=T,x=o("el-scrollbar"),D=o("el-button"),k=o("el-tooltip"),_=N;return c(),r("div",U,[d(q,{Layout:"breadcrumb,title,custom,fixed",cardStyle:Ve.value},{breadcrumb:u((()=>[m("div",z,[d(t,{separator:"/"},{default:u((()=>[d(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.65)"}},{default:u((()=>[A])),_:1}),d(l,{style:{"--el-text-color-regular":"rgba(0, 0, 0, 0.25)"}},{default:u((()=>[Q])),_:1})])),_:1})])])),title:u((()=>[m("div",{class:"title"},[m("div",{class:"title-desc"},[m("img",{class:"title-desc-img",src:J,alt:"",onClick:je}),B]),Y])])),custom:u((()=>[m("div",E,[d(C,{data:f(he).cache.flowList},null,8,["data"])]),d(x,{height:"calc(100vh - 300px)",style:{"padding-right":"24px"}},{default:u((()=>[m("div",H,[be.value?p((c(),g(s,{key:0,mode:"render",formJson:be.value,formData:f(he).cache.formData,optionData:f(he).cache.optionData,ref_key:"refFillFormInformation",ref:Pe},null,8,["formJson","formData","optionData"])),[[v,"one"===we.value]]):y("",!0),"two"===we.value?(c(),r("div",W,[d(b,{label:"审批流程"},{right:u((()=>[d(n,{modelValue:De.value,"onUpdate:modelValue":a[0]||(a[0]=e=>De.value=e),placeholder:"请选择流程",onChange:qe},{default:u((()=>[(c(!0),r(I,null,h(xe.value,(e=>(c(),g(i,{key:e.flowMessageId,label:e.flowName,value:e.flowMessageId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Se.value?(c(),g(L,P({key:0,id:"flow"},{readable:!0,mapable:!1,scroll:!1,scrollY:!1,top:"50"},{node:Se.value,wrapStyle:Ne.value}),null,16,["node","wrapStyle"])):y("",!0),m("div",G,[d(b,{label:"用印流程"}),m("div",K,[(c(!0),r(I,null,h(f(he).cache.PrintingProcess.list,((e,a)=>(c(),r("div",{class:"PrintingProcess-content-list",key:a},[m("div",R,[m("div",X,[Z,m("span",$,w(e.title),1)]),(c(!0),r(I,null,h(e.list,((e,a)=>(c(),r("div",{class:"PrintingProcess-content-list-cont-list",key:a},[m("div",ee,w(e.name),1),ae])))),128))]),m("div",le,[a<f(he).cache.PrintingProcess.list.length-1?(c(),r("img",te)):y("",!0)])])))),128))])])])):y("",!0)])])),_:1})])),fixed:u((()=>["one"===we.value?(c(),r("div",se,[m("div",ie,[d(D,{type:"primary",onClick:Je},{default:u((()=>[ne])),_:1}),d(D,{class:"ap-fixed-save",onClick:Oe},{default:u((()=>[oe,d(k,{class:"box-item",effect:"dark",content:"",placement:"top"},{content:u((()=>[ce])),default:u((()=>[re])),_:1})])),_:1})])])):y("",!0),"two"===we.value?(c(),r("div",de,[m("div",ue,[d(D,{type:"primary",loading:Ie.value,onClick:Fe},{default:u((()=>[me])),_:1},8,["loading"]),d(D,{onClick:Le},{default:u((()=>[fe])),_:1})])])):y("",!0)])),_:1},8,["cardStyle"]),d(_,{modelValue:ke.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ke.value=e),mode:1,onOnConfirm:Me,onOnCancel:Te,title:"保存模版"},{default:u((()=>[pe])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5dd70f9f"]]);export{ve as default};
