import{a7 as e,_ as l,s as t,h as a,v as i,r as d,o as s,c,m as n,a as u,u as r,b9 as h,F as o,e as v,w as f,t as p,P as g,Q as m,ba as y,f as S,bb as C,l as b,bc as w,bd as E,J as x,y as P,z as L,O as k,be as M,g as N,n as O,Y as V,M as T,bf as A}from"./main-5d732c2e.js";const F={treeList:l=>e({method:"GET",url:"/fileType/queryList",params:l})},J={style:{height:"100%"}},j={class:"select-search"},B={class:"select-crumbs user-select"},U={class:"custom-bread"},_=["onClick"],z={class:"item-arrow"},H={width:"6",height:"10",viewBox:"0 0 6 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Z=[(e=>(P("data-v-3e01129c"),e=e(),L(),e))((()=>n("path",{d:"M3.78132 5.00001L0.481323 1.70001L1.42399 0.757342L5.66666 5.00001L1.42399 9.24268L0.481323 8.30001L3.78132 5.00001Z",fill:"black","fill-opacity":"0.25"},null,-1)))],Q={class:"select-list user-select"},q=l({props:{apiModule:{type:String,default:""},allSelected:{type:Array,default:()=>[]},initQueryParams:{type:Object,default:()=>({})},multiple:{type:Boolean,default:!1}},emits:["update:allSelected"],setup(e,{expose:l,emit:P}){const L=e,k=t({get:()=>JSON.parse(JSON.stringify(L.allSelected)),set(e){P("update:allSelected",e)}}),M=[{id:"-1",pid:"0",name:"文件类型",haveChildren:!0,type:"fileType",idFullPathSet:"-1"}],N=a({lists:[]}),O=a({data:[]}),V=i([]),T=e=>new Promise(((l,t)=>{F.treeList(e).then((e=>{l(e)})).catch((e=>{t(e)}))})),A=i(""),q=i(!1),$=a({data:[]}),D=x((()=>{T({keyword:A.value,...L.initQueryParams}).then((e=>{const l=JSON.parse(JSON.stringify(e.data));0!==l&&(l.forEach((e=>{e.type="fileType"})),$.data=l),q.value=!0,A.value||(q.value=!1),0!==k.value.length&&0!==$.data&&$.data.forEach((e=>{k.value.forEach((l=>{e.id===l.id&&(e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0)}))}))}))}),500),I=()=>{A.value?D():q.value=!1};function G(e,l,t){if(t&&"all"===t)return Y(e,l),R(e,l),void $.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}));L.multiple?(W(e,l),X(e,l),$.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}))):O.data.forEach((t=>{t.id===e.id?(t.selectedStatus=l,k.value=l?[e]:[]):t.selectedStatus=0}))}const K=(e,l)=>{G(e,l)},Y=(e,l)=>{const t=e[0].pid;!function e(a){a.forEach((a=>{if(a.id===t&&a.children.forEach((e=>{e.selectedStatus=l})),a.children&&a.children.length>0)return e(a.children)}))}(V.value)},R=(e,l)=>{if(0===l){const e=[];O.data.forEach((l=>{l.selectedStatus=0,e.push(l.id)})),k.value=k.value.filter((l=>!e.includes(l.id)))}else{O.data.forEach((e=>{e.selectedStatus=2}));const l=[];e.forEach((e=>{l.push(e.id)})),k.value=k.value.filter((e=>!l.includes(e.id))).concat(e)}},W=(e,l)=>{!function t(a){a.forEach((a=>{if(a.id===e.id&&(a.selectedStatus=l),a.children&&a.children.length>0)return t(a.children)}))}(V.value)},X=(e,l)=>{if(0===l){let l=function(a){a.forEach((a=>{if(a.id===e.id&&e.haveChildren&&(a.includeChild="0"),a.id===e.id&&"1"===t){let e=function(l){l.forEach((l=>{if(l.selectedStatus=0,l.disabled=!1,l.children&&l.children.length>0)return e(l.children)}))};a.children&&e(a.children)}if(a.children&&a.children.length>0)return l(a.children)}))};O.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0)})),k.value=k.value.filter((l=>l.id!==e.id));const{includeChild:t}=k.value.find((l=>l.id===e.id));l(V.value),q.value&&$.data.forEach((l=>{!l.idFullPathSet.includes(e.id)||"1"!==e.includeChild&&e.includeChild||l.id===e.id||(l.disabled=!1,l.selectedStatus=0)}))}else{const l=JSON.parse(JSON.stringify(k.value));q.value&&$.data.forEach((t=>{t.id===e.id&&(t.id===e.id&&e.haveChildren&&(t.includeChild="0"),l.splice(k.value.length,0,t))})),O.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=2,q.value||l.splice(k.value.length,0,t))})),k.value=l}q.value&&$.data.forEach((t=>{t.id===e.id&&(t.selectedStatus=l)}))},ee=(e,l)=>{const t=[];if(!e)return[];if(0===e.length)return t.push({curmbsName:"文件类型",id:"-1"}),t;const a=function(e,l){for(let i=0;i<e.length;i++){const d=e[i];if(t.push({curmbsName:d.name,id:d.id}),d.id===l)return t;if(d.children){const e=a(d.children,l);if(e)return e}t.pop()}};return a(e,l),t},le=i([]),te=e=>{const l=i([]);if(function t(a){a.forEach((a=>{if(a.id===e.id&&(l.value=a.children),a.children&&a.children.length>0)return t(a.children)}))}(V.value),l.value&&l.value.length>0){O.data=ae(l.value,k.value);const t=ee(V.value,e.id);return void(le.value=t)}T({...L.initQueryParams,parentId:e.id}).then((l=>{const t=l.data;if(t.forEach((e=>{e.selectedStatus=0,e.includeChild="string"!=typeof e.includeChild?"0":e.includeChild,e.type="fileType",e.disabled=!!e.disabled})),O.data=ae(t,k.value),"-1"===e.id)return N.lists=t.concat(M),void(V.value=w(N.lists,"id","pid"));V.value=w(function(e,l="id"){if(!Array.isArray(e))return;return e.reduce(((e,t)=>e.some((e=>e[l]===t[l]))?e:[...e,t]),[])}([...E(V.value),...O.data]),"id","pid")}));const t=ee(V.value,e.id);le.value=t};function ae(e,l){return e.forEach((e=>{0===l.length?e.selectedStatus=0:l.forEach((l=>{e.id===l.id&&(e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0)}))})),e}const ie=(e,l)=>{e.forEach((e=>{if(e.id===l.id&&(e.selectedStatus=0,e.disabled=!1,e.includeChild="0"),e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&(e.selectedStatus=0,e.disabled=!1),e.children&&e.children.length>0)return ie(e.children,l)}))},de=e=>{e.forEach((e=>{if(e.selectedStatus=0,e.disabled=!1,e.children&&e.children.length>0)return de(e.children)}))},se=(e,l)=>{if(!l.haveChildren)return void(k.value=k.value.filter((e=>e.id!==l.id)));const t=i([]);JSON.parse(JSON.stringify(k.value)).forEach((e=>{e.idFullPathSet.includes(l.id)&&t.value.push(e.id)})),k.value=k.value.filter((e=>!t.value.includes(e.id)))},ce=(e,l)=>{Array.isArray(e)&&0!==e.length&&e.forEach((e=>{if(e.selectedStatus=l?2:0,e.disabled=l,e.children&&e.children.length>0)return ce(e.children,l)}))},ne=(e,l)=>{if(!l.haveChildren)return!1;const t=i([]);JSON.parse(JSON.stringify(k.value)).forEach((e=>{e.idFullPathSet.includes(l.id)&&e.id!==l.id&&t.value.push(e.id)})),k.value=k.value.filter((e=>!t.value.includes(e.id)))};return l({concelSelected:e=>{se(!1,e),ie(V.value,e),O.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0,l.disabled=!1),l.idFullPathSet.includes(e.id)&&"1"===e.includeChild&&(l.selectedStatus=0,l.disabled=!1)})),$.data.forEach((l=>{l.id===e.id&&(l.selectedStatus=0,l.disabled=!1),l.idFullPathSet.includes(e.id)&&"1"===e.includeChild&&(l.selectedStatus=0,l.disabled=!1)}))},clearSelected:()=>{k.value=[],de(O.data),de($.data),de(V.value)},changeSwitch:(e,l)=>{ne(e,l),function l(t,a){Array.isArray(t)&&0!==t.length&&t.forEach((t=>{if(t.id===a&&ce(t.children,e),t.children&&t.children.length>0)return l(t.children,a)}))}(V.value,l.id);const t=O.data[0].pid;!function e(l,t){Array.isArray(l)&&0!==l.length&&l.forEach((l=>{if(l.id===t&&(O.data=l.children),l.children&&l.children.length>0)return e(l.children,t)}))}(V.value,t),q.value&&$.data.forEach((e=>{e.idFullPathSet.includes(l.id)&&"1"===l.includeChild&&e.id!==l.id&&(e.disabled=!0,e.selectedStatus=2),e.idFullPathSet.includes(l.id)&&"0"===l.includeChild&&e.id!==l.id&&(e.disabled=!1,e.selectedStatus=0)}))},searchSelected:K}),(e,l)=>{const t=d("el-input"),a=d("el-tooltip");return s(),c("div",J,[n("div",j,[u(t,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value=e),placeholder:"搜索文件类型","prefix-icon":r(h),size:"large",clearable:"",onInput:I},null,8,["modelValue","prefix-icon"])]),n("div",B,[n("div",U,[(s(!0),c(o,null,v(le.value,((e,l)=>(s(),c("div",{class:"bread-item",key:l},[u(a,{content:e.curmbsName,placement:"bottom","show-after":200},{default:f((()=>[n("div",{class:"item-text",onClick:l=>(e=>{!function l(t,a){for(let i=0;i<=t.length-1;i++){if(t[i].id===e)return void(O.data=t[i].children);if(t[i].children&&t[i].children.length>0)return l(t[i].children)}}(V.value);const l=ee(V.value,e);le.value=l})(e.id)},p(e.curmbsName),9,_)])),_:2},1032,["content"]),n("div",z,[g((s(),c("svg",H,Z,512)),[[m,l!==le.value.length-1]])])])))),128))])]),n("div",Q,[g(u(y,{lists:r(O).data,"onUpdate:lists":l[1]||(l[1]=e=>r(O).data=e),onOpen:te,onEmitsDemo:G,rootNode:M,tabActive:"fileType",multiple:L.multiple},null,8,["lists","multiple"]),[[m,!q.value]]),q.value?(s(),S(C,{key:0,lists:r($).data,"onUpdate:lists":l[2]||(l[2]=e=>r($).data=e),onOpen:te,onSearchSelected:K,tabActive:"fileType"},null,8,["lists"])):b("",!0)])])}}},[["__scopeId","data-v-3e01129c"]]),$=e=>(P("data-v-13e08b3e"),e=e(),L(),e),D={class:"selection-content"},I={class:"selection-left user-select"},G={key:0,style:{height:"100%"}},K={style:{display:"flex","flex-direction":"column",flex:"1"}},Y={class:"select-right-column c-p"},R={class:"clear-n"},W={key:0},X={class:"null-img"},ee=[$((()=>n("img",{src:A},null,-1)))],le={class:"select-right-label"},te=$((()=>n("div",{style:{"margin-right":"10px"}},[n("svg",{width:"12",height:"19",viewBox:"0 0 10 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1 0C0.447715 0 0 0.447715 0 1V10C0 10.5523 0.447715 11 1 11H9C9.55228 11 10 10.5523 10 10V3.38462L8.33333 1.69231L6.66667 0H1ZM4.16667 2.53846H1.66667V3.38462H4.16667V2.53846ZM1.66667 5.07692H8.33333V5.92308H1.66667V5.07692ZM8.33333 7.61539H1.66667V8.46154H8.33333V7.61539Z",fill:"black","fill-opacity":"0.25"})])],-1))),ae={style:{display:"flex",height:"25px"}},ie=["onClick"],de=[$((()=>n("svg",{width:"16",height:"16",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0.4375 7C0.4375 3.4375 3.4375 0.4375 7 0.4375C10.5625 0.4375 13.5625 3.4375 13.5625 7C13.5625 10.5625 10.5625 13.5625 7 13.5625C3.4375 13.5625 0.4375 10.5625 0.4375 7ZM9.8125 9.71875C10.0938 9.53125 10.0938 9.15625 9.8125 8.875L7.9375 7L9.90625 5.03125C10.1875 4.75 10.1875 4.375 9.90625 4.09375C9.625 3.8125 9.25 3.8125 8.96875 4.09375L7 6.0625L5.125 4.1875C4.9375 3.90625 4.5625 3.90625 4.28125 4.1875C4 4.46875 4 4.84375 4.28125 5.03125L6.15625 6.90625L4.1875 8.875C3.90625 9.0625 3.90625 9.53125 4.1875 9.8125C4.46875 10.0938 4.84375 10.0938 5.125 9.8125L7.09375 7.84375L8.96875 9.71875C9.15625 10 9.53125 10 9.8125 9.71875Z",fill:"black","fill-opacity":"0.25"})],-1)))],se=l({props:{show:{type:Boolean,default:!1},apiModule:{type:String,default:""},queryParams:{type:Object,default:()=>({})},editDeploy:{type:Boolean,default:!1},searchSelected:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0}},emits:["update:show","update:searchSelected"],setup(e,{emit:l}){const t=e,a=i({width:"calc(100%)",height:"calc(100% - 40px)"}),r=i("");r.value=k.global.t("t-zgj-process.SelectUseType");const h=i(t.searchSelected||[]),y=i(!1),C=(e,l)=>new Promise(((a,i)=>{M[t.apiModule][l](e).then((e=>{a(e)})).catch((e=>{i(e)}))}));if(t.editDeploy){const e=M[t.apiModule].key;C(t.queryParams[e],"selected").then((e=>{y.value=!0}))}else y.value=!0;t.searchSelected.length>0&&(h.value=t.searchSelected.filter((e=>"fileType"===e.type)));const w=i(null),E=()=>{w.value.clearSelected()},x=()=>{l("update:show",!1)},P=i([]),L=()=>{const e={...t.queryParams,organs:h.value};t.editDeploy?C(e,"save").then((e=>{V.success(e.msg||"操作成功"),l("update:show",!1)})).catch((()=>{})):(P.value=P.value.concat(h.value),l("update:searchSelected",P.value),l("update:show",!1),P.value=[])};return(l,i)=>{const C=d("el-switch"),P=d("el-scrollbar"),k=T;return s(),S(k,{"onUpdate:show":t.show,show:t.show,title:r.value,onClose:x,onConfirm:L,confirmText:l.$t("t-zgj-select.confirm"),concelText:l.$t("t-zgj-operation.cancel"),centerBtn:"",height:574,width:900,appendToBody:"",customStyle:a.value},{default:f((()=>[n("div",D,[n("div",I,[y.value?(s(),c("div",G,[u(q,{ref_key:"kdocument",ref:w,initQueryParams:t.queryParams,apiModule:e.apiModule,allSelected:h.value,"onUpdate:allSelected":i[0]||(i[0]=e=>h.value=e),multiple:t.multiple},null,8,["initQueryParams","apiModule","allSelected","multiple"])])):b("",!0)]),n("div",K,[n("div",Y,[n("div",R,[N(p(l.$t("t-zgj-selectPerson.Selected"))+"： ",1),0!==h.value.length?(s(),c("span",W,p(h.value.length)+" "+p(l.$t("t-zgj-cg-menu-wenjian-leixing")),1)):b("",!0)]),g(n("div",{class:"select-close clear-t",onClick:E},p(l.$t("t-zgj-dialog-clear")),513),[[m,0!==h.value.length]])]),u(P,{class:"selection-right user-select",always:""},{default:f((()=>[g(n("div",X,ee,512),[[m,0===h.value.length]]),(s(!0),c(o,null,v(h.value,((e,l)=>(s(),c("div",{class:"select-right-column p",key:l},[n("div",le,[te,n("div",{class:"select-label",style:O(e.haveChildren&&t.multiple?"":"width: 340px")},p(e.name),5)]),n("div",ae,[e.haveChildren&&t.multiple?(s(),S(C,{key:0,modelValue:e.includeChild,"onUpdate:modelValue":l=>e.includeChild=l,"active-value":"1","inactive-value":"0",style:{"margin-right":"12px"},onChange:l=>{return t=l,a=e,void(w.value&&w.value.changeSwitch(t,a));var t,a}},null,8,["modelValue","onUpdate:modelValue","onChange"])):b("",!0),n("div",{class:"select-close",onClick:l=>{return t=e,void w.value.concelSelected(t);var t}},de,8,ie)])])))),128))])),_:1})])])])),_:1},8,["onUpdate:show","show","title","confirmText","concelText","customStyle"])}}},[["__scopeId","data-v-13e08b3e"]]);export{se as K};
