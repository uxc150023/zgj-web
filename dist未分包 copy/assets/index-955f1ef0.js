import{_ as e,s as t,v as l,i as a,r as n,o as s,c as o,a as i,w as u,m as r,n as c,u as d,t as v,x as f,y as h,z as p}from"./main-5d732c2e.js";const m=e=>(h("data-v-444f0115"),e=e(),p(),e),g={class:"vertify-box"},y={class:"vertify"},w={class:"content"},b={className:"canvasArea"},C=["width","height"],x=["width","height"],T=["className"],N=[m((()=>r("use",{href:"#btn1",class:"btn1"},null,-1))),m((()=>r("use",{href:"#btn2",class:"btn2"},null,-1)))],k={className:"sliderText"},M=[m((()=>r("div",{className:"loadingIcon"},null,-1))),m((()=>r("span",null,"加载中...",-1)))],R=m((()=>r("svg",{class:"iconpark-icon"},[r("use",{href:"#close"})],-1))),S=[m((()=>r("use",{href:"#flush"},null,-1)))],_=e({props:{title:{type:String,default:"title"},width:{type:Number,default:280},modelValue:{type:Boolean,default:!0},height:{type:Number,default:160},visible:{type:Boolean,default:()=>!0},l:{type:Number,default:42},r:{type:Number,default:9},imgUrl:{type:String,default:""},text:{type:String,default:"拖动滑块完成拼图"},onDraw:()=>{},onCustomVertify:()=>{},onBeforeRefresh:()=>{},onSuccess:()=>{},onFail:()=>{},onRefresh:()=>{}},emits:["update:modelValue","on-closed","click","on-success","on-failed"],setup(e,{emit:h}){const p=e,m=t({get:()=>p.modelValue,set(e){h("update:modelValue",e)}}),_=()=>{h("on-closed")},{text:I,l:V,r:X,imgUrl:D,width:A,height:B,visible:O,onBeforeRefresh:U,onRefresh:Y,onFail:F,onSuccess:$,onCustomVertify:q,onDraw:E}=p,L=l(!0),P=l(0),W=l("sliderContainer"),j=l(I),z=l(null),G=l(null),H=l(null),J=l(!1),K=l([]),Q=l(0),Z=l(0),ee=l(0),te=l(0),le=Math.PI,ae=V+2*X+3,ne=(e,t,l,a)=>{e.beginPath(),e.moveTo(t,l),e.arc(t+V/2,l-X+2,X,.72*le,2.26*le),e.lineTo(t+V,l),e.arc(t+V+X-2,l+V/2,X,1.21*le,2.78*le),e.lineTo(t+V,l+V),e.lineTo(t,l+V),e.arc(t+X-2,l+V/2,X+.4,2.76*le,1.24*le,!0),e.lineTo(t,l),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===a?e.fill():e.clip()},se=()=>D||`https://picsum.photos/id/${fe(0,1084)}/${A}/${B}`,oe=()=>{const e=(e=>{const t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=()=>{t.setSrc(se())},t.setSrc=e=>{if(window.navigator.userAgent.indexOf("Trident")>-1){const l=new XMLHttpRequest;l.onloadend=function(e){const l=new FileReader;l.readAsDataURL(e.target.response),l.onloadend=function(e){t.src=e.target.result}},l.open("GET",e),l.responseType="blob",l.send()}else t.src=e},t.setSrc(se()),t})((()=>{L.value=!1,(e=>{const t=z.value.getContext("2d"),l=G.value.getContext("2d");ee.value=fe(ae+10,A-(ae+10)),te.value=fe(10+2*X,B-(ae+10)),ne(t,ee.value,te.value,"fill"),ne(l,ee.value,te.value,"clip"),t.drawImage(e,0,0,A,B),l.drawImage(e,0,0,A,B);const a=te.value-2*X-1,n=l.getImageData(ee.value-3,a,ae,ae);G.value.width=ae,l.putImageData(n,0,a)})(e)}));H.value=e},ie=()=>{const e=z.value.getContext("2d"),t=G.value.getContext("2d");P.value=0,W.value="sliderContainer",G.value.width=A,G.value.style.left="0px",e.clearRect(0,0,A,B),t.clearRect(0,0,A,B),U&&U(),L.value=!0,H.value.setSrc(se())},ue=()=>{ie(),"function"==typeof Y&&Y()},re=()=>{const e=K.value,t=e.reduce(he)/e.length,l=e.map((e=>e-t)),a=Math.sqrt(l.map(pe).reduce(he)/e.length),n=parseInt(G.value.style.left);return{spliced:Math.abs(n-ee.value)<10,verified:0!==a,left:n,destX:ee.value}},ce=function(e){Q.value=e.clientX||e.touches[0].clientX,Z.value=e.clientY||e.touches[0].clientY,J.value=!0},de=e=>{if(!J.value)return!1;e.preventDefault();const t=e.clientX||e.touches[0].clientX,l=e.clientY||e.touches[0].clientY,a=t-Q.value,n=l-Z.value;if(a<0||a+38>=A)return!1;P.value=a;const s=(A-40-20)/(A-40)*a;G.value.style.left=s+"px",W.value="sliderContainer sliderContainer_active",K.value.push(n),E&&E(s)},ve=e=>{if(!J.value)return!1;J.value=!1;if((e.clientX||e.changedTouches[0].clientX)===Q.value)return!1;W.value="sliderContainer";const{spliced:t,verified:l}=q?q(re()):re();t?l?(W.value="sliderContainer sliderContainer_success","function"==typeof $&&$(),m.value=!1,h("on-success")):(W.value="sliderContainer sliderContainer_fail",j.value="请再试一次",h("on-failed"),ie()):(W.value="sliderContainer sliderContainer_fail","function"==typeof F&&F(),setTimeout(ie.bind(this),1e3))},fe=(e,t)=>Math.round(Math.random()*(t-e)+e),he=(e,t)=>e+t,pe=e=>e*e,me=()=>{oe()};return a((()=>O),(()=>{O&&(H.value?ie():oe())})),(e,t)=>{const l=n("el-dialog");return s(),o("div",g,[i(l,{modelValue:d(m),"onUpdate:modelValue":t[0]||(t[0]=e=>f(m)?m.value=e:null),width:d(A),center:"","align-center":"","destroy-on-close":"",onClosed:_,onOpen:me},{default:u((()=>[r("div",y,[r("div",w,[r("div",{className:"vertifyWrap",style:c({width:d(A)+"px",margin:"0 auto",display:d(O)?"":"none"}),onMousemove:de,onMouseup:ve,onTouchmove:de,onTouchend:ve},[r("div",b,[r("canvas",{ref_key:"canvasRef",ref:z,width:d(A),height:d(B)},null,8,C),r("canvas",{ref_key:"blockRef",ref:G,className:"block",width:d(A),height:d(B),onMousedown:ce,onTouchstart:ce},null,40,x)]),r("div",{className:W.value,style:c({pointerEvents:L.value?"none":"auto"})},[r("div",{className:"sliderMask",style:c({width:P.value>0?P.value+8+"px":P.value+"px"})},[(s(),o("svg",{class:"iconpark-icon slider",style:c({left:P.value-10+"px"}),onMousedown:ce,onTouchstart:ce},N,36))],4),r("div",k,v(j.value),1)],12,T),r("div",{className:"loadingContainer",style:c({width:d(A)+"px",height:d(B)+"px",display:L.value?"":"none"})},M,4)],36),r("div",{class:"vertify-footer"},[R,r("svg",{class:"iconpark-icon",onClick:ue},S)])])])])),_:1},8,["modelValue","width"])])}}},[["__scopeId","data-v-444f0115"]]);export{_ as default};
