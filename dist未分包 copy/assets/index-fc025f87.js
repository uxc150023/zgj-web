import{_ as e,v as a,h as o,j as t,r as l,o as n,c as r,a as d,w as s,m as u,g as i,t as c,f as m,q as g,u as p,l as h,P as v,Q as f,b3 as b,aa as w,H as N,M as y,y as I,z as j,ct as D}from"./main-5d732c2e.js";import{_ as x}from"./gengduo-caozuo-1d3fc6a0.js";import{_ as P}from"./ketanchude-65de0c89.js";import{J as _}from"./JyTable-96032540.js";import{a as z}from"./department-01ce1805.js";import{a as k}from"./actionMoreDialog-4a1fdaac.js";import{_ as T}from"./index-4f386a23.js";import"./sangedian-b1ee72e5.js";import"./Layout-db7f64fa.js";import"./searchForm-a97b647c.js";import"./KDocumentTypeDialog-1f624042.js";import"./pagination-569fa38f.js";import"./batch-e7262433.js";import"./index-b9b96043.js";import"./index-18b4acbd.js";import"./cha-kong-1ced20bc.js";import"./index-01980554.js";import"./yuan-hui-e1a80bc6.js";import"./index-60e1d355.js";import"./home-back-426c97de.js";import"./logo-00c7cf54.js";import"./request-util-ecea08f4.js";const B=[{prop:"organName",label:"部门名称","min-width":150,fixed:"left",show:!0},{prop:"organNo",label:"部门编码","min-width":150,show:!0},{prop:"organTypeName",label:"组织类型","min-width":150,show:!0},{prop:"organUserNum",label:"部门人数",sortable:"custom",align:"center",width:150,show:!0},{prop:"organLeaderName",label:"部门主管","min-width":150,show:!0},{prop:"organPName",label:"上级组织","min-width":150,show:!0},{prop:"flag",label:"状态",show:!0},{prop:"caozuo",label:"操作","min-width":250,fixed:"right",align:"center",show:!0,rankDisplayData:[{name:"t-zgj-Edit"},{name:"status"},{name:"t-zgj-Delete"}]}],C=e=>(I("data-v-36305306"),e=e(),j(),e),L={class:"title"},A=C((()=>u("div",null,"单位与部门管理",-1))),V={class:"title-more"},O={class:"title-more-add"},U={class:"title-more-down"},E=C((()=>u("img",{class:"button-icon",src:x,alt:"",srcset:""},null,-1))),S=i("导入"),F={class:"components-tree"},$=i("部门"),q=i("单位"),J={class:"select-box-contBox"},R=C((()=>u("div",{class:"ap-box-contBox-icon"},[u("img",{class:"ap-box-contBox-icon-img",src:P,alt:""})],-1))),H={class:"select-box-contBox"},M=C((()=>u("div",{class:"ap-box-contBox-icon"},[u("img",{class:"ap-box-contBox-icon-img",src:P})],-1))),W={class:"header-div"},Y=C((()=>u("img",{src:D},null,-1))),K={class:"content-div"},Q=e({setup(e){const I=a(!1),j=a([]),D=a(!1),x=a(!1),P=a(!1),C=a(null),Q=a([]),X=a(["organ"]),Z=a(null),G=a("-1"),ee=a(null),ae=a(!1),oe=a(!1),te=a(null),le=a(null),ne=a(!1),re=a(null),de=a(null),se=a(null),ue=a(null),ie=a(null),ce=a([]),me=a(null),ge=o({organId:"",organNo:"",organName:"",organTypeId:"department",organPid:"",organPName:"",organLeaderId:"",organLeaderName:"",readme:""}),pe=o({organName:[{required:!0,message:"请输入部门名称",trigger:"change"}],organPName:[{required:!0,message:"请选择上级部门",trigger:"change"}]}),he=o({showOneAction:{show:!1,header:{data:""},content:{data:""}},componentsSearchForm:{data:[{id:"keyWord",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"部门名称/部门编码"}},{id:"flag",label:"状态",type:"select",inCommonUse:!0,options:[{label:"启用",value:1},{label:"停用",value:0}],defaultAttribute:{placeholder:"请选择"}}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:B},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"organId","current-node-key":"-1",accordion:!0},defaultProps:{label:"organName",children:"children",isLeaf:"haveChildren"},value:""},componentsBatch:{selectionData:[],data:[{name:"t-zgj-dept.BatchDeactivation"},{name:"t-zgj-dept.BatchEnable"},{name:"t-zgj-seal.BatchDelete"}]}});function ve(e,a,o,t){G.value=e.organId,I.value=!0,j.value=[{value:"detail",params:e.organId},{value:"organizer",params:e.organId}]}function fe(e,a,o,t){"t-zgj-Edit"===o.name?(D.value=!0,ge.organId=a.organId,w((()=>{C.value.resetFields(),z.detail(a.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||N("accountInfo")&&N("accountInfo").userDepartName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))):"t-zgj-F_SEAL_INFO_UP"===o.name||"t-zgj-F_SEAL_INFO_DOWN"===o.name||("status"===o.name?(ue.value="启用"===a.flag?"t-zgj-Disable":"t-zgj-Enable",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示","启用"===a.flag?he.showOneAction.content.data="是否停用该部门？":he.showOneAction.content.data="是否启用该部门？"):"t-zgj-Delete"===o.name&&(ue.value="t-zgj-Delete",se.value=a.organId,he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门？"))}function be(){"t-zgj-Enable"===ue.value?z.batchEnable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Disable"===ue.value?z.batchDisable([se.value]).then((e=>{ee.value.reloadData()})).finally((()=>{he.showOneAction.show=!1})):"t-zgj-Delete"===ue.value&&z.batchDelete([se.value]).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{ne.value=!1,he.showOneAction.show=!1}))}function we(e,a){re.value=e.name,"t-zgj-dept.BatchDeactivation"===e.name?de.value={header:{data:"批量停用"},content:{data:"是否批量停用这些部门？"}}:"t-zgj-dept.BatchEnable"===e.name?de.value={header:{data:"批量启用"},content:{data:"是否批量启用这些部门？"}}:"t-zgj-seal.BatchDelete"===e.name&&(de.value={header:{data:"批量删除"},content:{data:"是否批量删除这些部门？"}}),he.componentsBatch.selectionData=a,ne.value=!0}const Ne=e=>{P.value=!0,Z.value=e,"organP"===e?(X.value=["organ"],Q.value=ge.organPid?[{id:ge.organPid,name:ge.organPName,type:"organ"}]:[]):(X.value=["user"],Q.value=ge.organLeaderId?[{id:ge.organLeaderId,name:ge.organLeaderName,type:"user"}]:[]),setTimeout((()=>{x.value=!0}),200)},ye=()=>{x.value=!1,setTimeout((()=>{P.value=!1}),200)},Ie=()=>{D.value=!0,w((()=>{ge.organPid="",ge.organId="",ge.organPName="",ge.organLeaderName="",C.value.resetFields()}))},je=a(!0),De=()=>{C.value.validate((e=>{e&&(ge.organId?(je.value=!1,z.edit(ge).then((()=>{D.value=!1,ie.value.loaded=!1,ie.value.expand(),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))):(ie.value=me.value.getNode(ge.organPid),je.value=!1,z.add(ge).then((()=>{ie.value&&(he.componentsTree.defaultAttribute["current-node-key"]=ge.organPid,G.value=ge.organPid,D.value=!1,ie.value.loaded=!1,ie.value.expand()),ee.value.reloadData(),je.value=!0})).catch((()=>{je.value=!0}))))}))},xe=e=>{"organP"===Z.value?(ge.organPid=e.length?e[0].id:"",ge.organPName=e.length?e[0].name:""):(ge.organLeaderId=e.length?e[0].id:"",ge.organLeaderName=e.length?e[0].name:"")};function Pe(e,a){if(0===e.level)ie.value=e,z.subOrganList(-1).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),ce.value=e.data,a([{organName:N("accountInfo")&&N("accountInfo").userDepartName,organId:"-1",haveChildren:!1,children:[]}])))).then((()=>{w((()=>{const e=ie.value.childNodes[0];e&&(e.expanded=!0),e&&e.loadData()}))}));else{if(1===e.level)return a(ce.value);z.subOrganList(e.data.organId).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),a(e.data))))}}function _e(e,a){ie.value=a,G.value=e.organId,ee.value.reloadData()}function ze(e,a,o){1===o.level?oe.value=!1:oe.value=!0,ae.value=!0,le.value=a,te.value.$el.style.right=0,te.value.$el.style.top=e.layerY+10+"px",document.addEventListener("click",ke)}function ke(){ae.value=!1,document.removeEventListener("click",ke)}function Te(){D.value=!0,w((()=>{C.value.resetFields(),ge.organPid=le.value.organId,ge.organPName=le.value.organName}))}function Be(){D.value=!0,ge.organId=le.value.organId,w((()=>{C.value.resetFields(),z.detail(le.value.organId).then((e=>{const a=e.data;ge.organId=a.organId,ge.organNo=a.organNo,ge.organName=a.organName,ge.organTypeId=a.organTypeId,ge.organPid=a.organPid,ge.organPName=a.organPName||JSON.parse(localStorage.getItem("departLists")).find((e=>e.tenantId===localStorage.getItem("tenantId"))).tenantName,ge.organLeaderId=a.organLeaderId,ge.organLeaderName=a.organLeaderName,ge.readme=a.readme}))}))}function Ce(){se.value=le.value.organId,ue.value="t-zgj-Delete",he.showOneAction.show=!0,he.showOneAction.header.data="提示",he.showOneAction.content.data="是否删除该部门"}const Le=()=>{"t-zgj-dept.BatchDeactivation"===re.value?z.batchDisable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{ne.value=!1})):"t-zgj-dept.BatchEnable"===re.value?z.batchEnable(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData()})).finally((()=>{ne.value=!1})):"t-zgj-seal.BatchDelete"===re.value&&z.batchDelete(he.componentsBatch.selectionData.map((e=>e.organId))).then((e=>{ee.value.reloadData(),ie.value.loaded=!1,ie.value.expand()})).finally((()=>{ne.value=!1}))};return t((()=>{})),(e,a)=>{const o=l("el-button"),t=l("el-dropdown-item"),w=l("el-dropdown-menu"),N=l("el-dropdown"),z=l("el-tree"),B=l("el-card"),Z=l("el-input"),le=l("el-form-item"),re=l("el-radio"),se=l("el-radio-group"),ue=l("el-form"),ie=y,ce=l("JyElMessageBox");return n(),r("div",null,[d(_,{url:"/organ/page",ref_key:"table",ref:ee,componentsSearchForm:p(he).componentsSearchForm,componentsTableHeader:p(he).componentsTable.header,componentsBatch:p(he).componentsBatch,queryParams:{organId:G.value},statusColoum:"flag",openValue:"启用",hasTree:"",tableClick:"organName",onCellClick:ve,onCustomClick:fe,onClickBatchButton:we},{title:s((()=>[u("div",L,[A,u("div",V,[u("div",O,[d(o,{type:"primary",onClick:Ie},{default:s((()=>[i("+ "+c(e.$t("t-zgj-add")),1)])),_:1})]),u("div",U,[d(N,{"popper-class":"more-operation-dropdown"},{dropdown:s((()=>[d(w,null,{default:s((()=>[d(t,null,{default:s((()=>[S])),_:1})])),_:1})])),default:s((()=>[d(o,null,{default:s((()=>[E,u("span",null,c(e.$t("t-zgj-table.more.Operation")),1)])),_:1})])),_:1})])])])])),tree:s((()=>[u("div",F,[je.value?(n(),m(z,g({key:0,ref_key:"deptTreeRef",ref:me,data:p(he).componentsTree.data,props:p(he).componentsTree.defaultProps},p(he).componentsTree.defaultAttribute,{lazy:"",load:Pe,onCurrentChange:_e,onNodeContextmenu:ze}),null,16,["data","props"])):h("",!0),v(d(B,{class:"box-card",ref_key:"card",ref:te,"body-style":{padding:"0 10px"}},{default:s((()=>[u("div",{class:"add",onClick:Te},"添加子部门"),v(u("div",{class:"delete",onClick:Be}," 编辑部门 ",512),[[f,oe.value]]),v(u("div",{class:"edit",onClick:Ce}," 删除部门 ",512),[[f,oe.value]])])),_:1},512),[[f,ae.value]])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),d(T,{modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value=e),modulesName:"unit_and_department",detailParams:j.value},null,8,["modelValue","detailParams"]),d(ie,{"onUpdate:show":a[9]||(a[9]=e=>D.value=e),show:D.value,title:p(ge).organId?e.$t("t-zgj-Edit"):e.$t("t-zgj-add"),centerBtn:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),width:900,height:400,onConfirm:De},{default:s((()=>[d(ue,{model:p(ge),rules:p(pe),ref_key:"vFormLibraryRef",ref:C,"label-width":"80px"},{default:s((()=>[d(le,{label:"部门名称",prop:"organName"},{default:s((()=>[d(Z,{modelValue:p(ge).organName,"onUpdate:modelValue":a[1]||(a[1]=e=>p(ge).organName=e),placeholder:"请输入",clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),d(le,{label:"组织类型",prop:"organTypeId"},{default:s((()=>[d(se,{modelValue:p(ge).organTypeId,"onUpdate:modelValue":a[2]||(a[2]=e=>p(ge).organTypeId=e)},{default:s((()=>[d(re,{label:"department",size:"large"},{default:s((()=>[$])),_:1}),d(re,{label:"unit",size:"large"},{default:s((()=>[q])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(le,{label:"部门编码",prop:"organNo"},{default:s((()=>[d(Z,{modelValue:p(ge).organNo,"onUpdate:modelValue":a[3]||(a[3]=e=>p(ge).organNo=e),placeholder:"请输入",maxlength:"64"},null,8,["modelValue"])])),_:1}),d(le,{label:"上级部门",prop:"organPName"},{default:s((()=>[u("div",J,[d(Z,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:p(ge).organPName,"onUpdate:modelValue":a[4]||(a[4]=e=>p(ge).organPName=e),placeholder:"请选择",onClick:a[5]||(a[5]=e=>Ne("organP"))},null,8,["modelValue"]),R])])),_:1}),d(le,{label:"部门领导",prop:"organLeaderId"},{default:s((()=>[u("div",H,[d(Z,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:p(ge).organLeaderName,"onUpdate:modelValue":a[6]||(a[6]=e=>p(ge).organLeaderName=e),placeholder:"请选择",onClick:a[7]||(a[7]=e=>Ne("leaderUser"))},null,8,["modelValue"]),M])])),_:1}),d(le,{label:"备注",prop:"readme"},{default:s((()=>[d(Z,{modelValue:p(ge).readme,"onUpdate:modelValue":a[8]||(a[8]=e=>p(ge).readme=e),type:"textarea",maxlength:"512"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show","title","confirmText","concelText"]),P.value?(n(),m(p(b),{key:0,show:x.value,"onUpdate:show":ye,searchSelected:Q.value,"onUpdate:searchSelected":xe,tabsShow:X.value,multiple:!1,hasTopRoot:!0},null,8,["show","searchSelected","tabsShow"])):h("",!0),d(p(k),{"onUpdate:modelValue":a[10]||(a[10]=e=>ne.value=!1),show:ne.value,selectionData:p(he).componentsBatch.selectionData,showToastDialogContent:de.value,label:"organName",onSureAction:Le},null,8,["show","selectionData","showToastDialogContent"]),d(ce,{modelValue:p(he).showOneAction.show,"onUpdate:modelValue":a[11]||(a[11]=e=>p(he).showOneAction.show=e),mode:1,showClose:!1,defaultAttribute:{},onConfirmClick:be},{header:s((()=>[u("div",W,[Y,u("span",null,c(p(he).showOneAction.header.data),1)])])),content:s((()=>[u("div",K,c(p(he).showOneAction.content.data),1)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-36305306"]]);export{Q as default};
